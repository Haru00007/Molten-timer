<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Timer Controller</title>
    <style>
        @font-face {
            font-family: 'DSEG7 Classic';
            src: url('./fonts/DSEG7Classic-Bold.woff2') format('woff2');
            font-weight: bold;
            font-style: normal;
        }

        @font-face {
            font-family: 'LED Calculator';
            src: url('./fonts/LEDCalculator.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #1a1a1a;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            color: #ccc;
        }

        h1 {
            font-family: 'LED Calculator', sans-serif;
            color: #0d0;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .monitor {
            background-color: #000;
            border: 2px solid #333;
            border-radius: 4px;
            padding: 15px 25px;
            margin-bottom: 30px;
            font-family: 'LED Calculator', sans-serif;
            font-size: 28px;
            line-height: 1.8;
            color: #0d0;
            min-width: 450px;
        }

        .monitor-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .mon-slot {
            display: inline-block;
            min-width: 20px;
            text-align: center;
        }

        .monitor .period-display {
            color: orange;
        }

        .monitor .timer-display {
            color: #fff;
            min-width: 80px;
            text-align: center;
        }

        .monitor .score-display {
            color: orange;
            min-width: 50px;
            text-align: right;
        }

        .monitor .shot-clock-display {
            color: #d00;
            min-width: 40px;
            min-height: 1em;
            text-align: right;
        }

        .monitor .arrow {
            color: #222;
        }

        .monitor .arrow.active {
            color: #d00;
        }

        .controls-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-section {
            background-color: #222;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            min-width: 200px;
        }

        .section-title {
            font-family: 'LED Calculator', sans-serif;
            color: #0d0;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 1px solid #444;
            padding-bottom: 8px;
        }

        .button-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            justify-content: center;
        }

        .control-btn {
            background-color: #333;
            border: 1px solid #555;
            color: #ccc;
            font-family: 'LED Calculator', sans-serif;
            font-size: 12px;
            padding: 10px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.1s;
            min-width: 60px;
        }

        .control-btn:hover {
            background-color: #444;
            border-color: #777;
            color: #fff;
        }

        .control-btn:active {
            background-color: #555;
            transform: translateY(1px);
        }

        .control-btn.toggled {
            background-color: #300;
            border-color: #d00;
            color: #d00;
        }

        .control-btn.active-green {
            background-color: #030;
            border-color: #0d0;
            color: #0d0;
        }

        .control-btn.wide {
            min-width: 100px;
        }

        .control-btn.full-width {
            width: 100%;
        }

        .control-btn.hold-active {
            background-color: #111;
            color: #333;
        }
    </style>
</head>

<body>
    <h1>F01 Basketball Timer</h1>

    <!-- F01 Monitor -->
    <div id="monitor-f01" class="monitor">
        <div class="monitor-row">
            <span id="mon-period" class="period-display mon-slot">1</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-arrow-left" class="arrow">&lt;</span>
            <span class="mon-slot">H</span>
            <span id="mon-timer" class="timer-display">10:00</span>
            <span class="mon-slot">G</span>
            <span id="mon-arrow-right" class="arrow">&gt;</span>
        </div>
        <div class="monitor-row">
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-score-home" class="score-display">0</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-shot-clock" class="shot-clock-display">24</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-score-guest" class="score-display">0</span>
        </div>
    </div>

    <!-- F02 Monitor -->
    <div id="monitor-f02" class="monitor" style="display: none;">
        <div class="monitor-row">
            <span id="mon-f02-period" class="period-display mon-slot"> </span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f02-arrow-left" class="arrow">&lt;</span>
            <span id="mon-f02-score-left" class="score-display">0</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f02-score-right" class="score-display">0</span>
            <span id="mon-f02-arrow-right" class="arrow">&gt;</span>
        </div>
        <div class="monitor-row">
            <span id="mon-f02-sets-left" class="score-display">0</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f02-timeout" class="shot-clock-display"></span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f02-sets-right" class="score-display">0</span>
        </div>
    </div>

    <!-- F03 Monitor (Judo) -->
    <div id="monitor-f03" class="monitor" style="display: none;">
        <div class="monitor-row">
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f03-timer" class="timer-display">10:00</span>
        </div>
        <div class="monitor-row">
            <span id="mon-f03-waza" class="mon-slot" style="color: #d00; min-width: 60px;"></span>
            <span id="mon-f03-osaekomi" class="shot-clock-display"></span>
        </div>
    </div>

    <!-- F04 Monitor (Boxing) -->
    <div id="monitor-f04" class="monitor" style="display: none;">
        <div class="monitor-row">
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f04-timer" class="timer-display">0:00</span>
        </div>
        <div class="monitor-row">
            <span id="mon-f04-round" class="score-display" style="min-width: 40px;">0</span>
            <span class="mon-slot">&nbsp;</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f04-program" class="score-display" style="min-width: 60px;">P01</span>
        </div>
    </div>

    <!-- F05 Monitor (Wrestling) -->
    <div id="monitor-f05" class="monitor" style="display: none;">
        <div class="monitor-row">
            <span id="mon-f05-period" class="period-display mon-slot">1</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f05-timer" class="timer-display">0:00</span>
        </div>
        <div class="monitor-row">
            <span id="mon-f05-score-left" class="score-display" style="min-width: 50px;">0</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f05-winner" class="score-display" style="min-width: 40px; color: #0d0;"></span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f05-score-right" class="score-display" style="min-width: 50px;">0</span>
        </div>
    </div>

    <!-- F06 Monitor (Program Timer / Repeat) -->
    <div id="monitor-f06" class="monitor" style="display: none;">
        <div class="monitor-row">
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f06-timer" class="timer-display">0:00</span>
        </div>
        <div class="monitor-row">
            <span id="mon-f06-repeat" class="score-display" style="min-width: 50px;">0</span>
            <span class="mon-slot">&nbsp;</span>
            <span class="mon-slot">&nbsp;</span>
            <span id="mon-f06-program" class="score-display" style="min-width: 60px;">P01</span>
        </div>
    </div>

    <!-- F07 Monitor (Shuttle Run) -->
    <div id="monitor-f07" class="monitor" style="display: none;">
        <div class="monitor-row">
            <span id="mon-f07-dotcount" class="period-display mon-slot">0</span>
            <span id="mon-f07-arrow-left" class="arrow-indicator mon-slot">&lt;</span>
            <span id="mon-f07-count" class="timer-display">0:05</span>
            <span id="mon-f07-arrow-right" class="arrow-indicator mon-slot">&gt;</span>
        </div>
        <div class="monitor-row">
            <span class="mon-slot">L</span>
            <span id="mon-f07-level" class="score-display" style="min-width: 30px;">1</span>
            <span id="mon-f07-shuttletime" class="score-display" style="min-width: 40px;">9.0</span>
            <span id="mon-f07-score-male" class="score-display" style="min-width: 20px; color: #4af;">1</span>
            <span style="color: orange;">-</span>
            <span id="mon-f07-score-female" class="score-display" style="min-width: 20px; color: #f66;">1</span>
        </div>
    </div>

    <!-- F01 Controls -->
    <div id="controls-f01" class="controls-container">
        <div class="control-section">
            <div class="section-title">Sub-Timer</div>
            <div class="button-row">
                <button id="sub-clear" class="control-btn">Clear</button>
                <button id="sub-toggle-time" class="control-btn">24/30</button>
            </div>
            <div class="button-row">
                <button id="sub-plus-1s" class="control-btn">+1s</button>
                <button id="sub-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="sub-14s-start" class="control-btn wide">14s Start</button>
            </div>
            <div class="button-row">
                <button id="sub-reset" class="control-btn">Reset</button>
                <button id="sub-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>

        <div class="control-section"
            style="display: flex; align-items: center; justify-content: center; min-width: 80px;">
            <button id="change-function" class="control-btn"
                style="white-space: pre-line; line-height: 1.4; padding: 15px 12px;">Change
                Function</button>
        </div>

        <div class="control-section">
            <div class="section-title">Timer</div>
            <div class="button-row">
                <button id="timer-clear" class="control-btn">Clear</button>
                <button id="timer-count-mode" class="control-btn">Up/Down</button>
                <button id="timer-show-tenths" class="control-btn">1/10s</button>
            </div>
            <div class="button-row">
                <button id="timer-plus-1m" class="control-btn">+1m</button>
                <button id="timer-minus-1m" class="control-btn">-1m</button>
                <button id="timer-plus-1s" class="control-btn">+1s</button>
                <button id="timer-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="timer-plus-tenth" class="control-btn">+1/10s</button>
                <button id="timer-minus-tenth" class="control-btn">-1/10s</button>
            </div>
            <div class="button-row">
                <button id="timer-reset" class="control-btn">Reset</button>
                <button id="timer-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>

        <div class="control-section">
            <div class="section-title">Score</div>
            <div class="button-row">
                <button id="score-hg-toggle" class="control-btn">H/G</button>
                <button id="score-court-change" class="control-btn">Court</button>
            </div>
            <div class="button-row">
                <button id="score-arrow-left" class="control-btn">&lt;</button>
                <button id="score-period" class="control-btn">P</button>
                <button id="score-arrow-right" class="control-btn">&gt;</button>
            </div>
            <div class="button-row">
                <button id="score-left-plus" class="control-btn">L+1</button>
                <button id="score-right-plus" class="control-btn">R+1</button>
            </div>
            <div class="button-row">
                <button id="score-left-minus" class="control-btn">L-1</button>
                <button id="score-right-minus" class="control-btn">R-1</button>
            </div>
            <div class="button-row">
                <button id="score-reset" class="control-btn full-width">Reset</button>
            </div>
        </div>
    </div>

    <!-- F02 Controls -->
    <div id="controls-f02" class="controls-container" style="display: none;">
        <div class="control-section">
            <div class="section-title">Timeout Timer</div>
            <div class="button-row">
                <button id="f02-timeout-plus-1s" class="control-btn">+1s</button>
                <button id="f02-timeout-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="f02-timeout-reset" class="control-btn">Reset</button>
                <button id="f02-timeout-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>

        <div class="control-section"
            style="display: flex; align-items: center; justify-content: center; min-width: 80px;">
            <button id="f02-change-function" class="control-btn"
                style="white-space: pre-line; line-height: 1.4; padding: 15px 12px;">Change
                Function</button>
        </div>

        <div class="control-section">
            <div class="section-title">Score</div>
            <div class="button-row">
                <button id="f02-score-arrow-left" class="control-btn">&lt;</button>
                <button id="f02-score-period" class="control-btn">P</button>
                <button id="f02-score-arrow-right" class="control-btn">&gt;</button>
            </div>
            <div class="button-row">
                <button id="f02-score-left-plus" class="control-btn">L+1</button>
                <button id="f02-score-right-plus" class="control-btn">R+1</button>
            </div>
            <div class="button-row">
                <button id="f02-score-left-minus" class="control-btn">L-1</button>
                <button id="f02-score-right-minus" class="control-btn">R-1</button>
            </div>
            <div class="button-row">
                <button id="f02-score-reset" class="control-btn full-width">Reset</button>
            </div>
        </div>

        <div class="control-section">
            <div class="section-title">Game Sets</div>
            <div class="button-row">
                <button id="f02-sets-left-plus" class="control-btn">L+1</button>
                <button id="f02-sets-right-plus" class="control-btn">R+1</button>
            </div>
            <div class="button-row">
                <button id="f02-sets-left-minus" class="control-btn">L-1</button>
                <button id="f02-sets-right-minus" class="control-btn">R-1</button>
            </div>
            <div class="button-row">
                <button id="f02-sets-reset" class="control-btn full-width">Reset</button>
            </div>
        </div>
    </div>

    <!-- F03 Controls (Judo) -->
    <div id="controls-f03" class="controls-container" style="display: none;">
        <div class="control-section">
            <div class="section-title">Waza</div>
            <div class="button-row">
                <button id="f03-waza-on" class="control-btn">On</button>
                <button id="f03-waza-off" class="control-btn">Off</button>
            </div>
        </div>

        <div class="control-section"
            style="display: flex; align-items: center; justify-content: center; min-width: 80px;">
            <button id="f03-change-function" class="control-btn"
                style="white-space: pre-line; line-height: 1.4; padding: 15px 12px;">Change
                Function</button>
        </div>

        <div class="control-section">
            <div class="section-title">Timer</div>
            <div class="button-row">
                <button id="f03-timer-clear" class="control-btn">Clear</button>
                <button id="f03-timer-count-mode" class="control-btn">Up/Down</button>
                <button id="f03-timer-show-tenths" class="control-btn">1/10s</button>
            </div>
            <div class="button-row">
                <button id="f03-timer-plus-1m" class="control-btn">+1m</button>
                <button id="f03-timer-minus-1m" class="control-btn">-1m</button>
                <button id="f03-timer-plus-1s" class="control-btn">+1s</button>
                <button id="f03-timer-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="f03-timer-plus-tenth" class="control-btn">+1/10s</button>
                <button id="f03-timer-minus-tenth" class="control-btn">-1/10s</button>
            </div>
            <div class="button-row">
                <button id="f03-timer-reset" class="control-btn">Reset</button>
                <button id="f03-timer-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>

        <div class="control-section">
            <div class="section-title">Osae-komi</div>
            <div class="button-row">
                <button id="f03-osaekomi-plus-1s" class="control-btn">+1s</button>
                <button id="f03-osaekomi-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="f03-osaekomi-reset" class="control-btn">Reset</button>
                <button id="f03-osaekomi-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>
    </div>

    <!-- F04 Controls (Boxing) -->
    <div id="controls-f04" class="controls-container" style="display: none;">
        <div class="control-section">
            <div class="section-title">Rounds</div>
            <div class="button-row">
                <button id="f04-rounds-plus" class="control-btn">+1R</button>
                <button id="f04-rounds-minus" class="control-btn">-1R</button>
            </div>
            <div class="button-row">
                <button id="f04-rounds-reset" class="control-btn full-width">Reset</button>
            </div>
        </div>

        <div class="control-section"
            style="display: flex; align-items: center; justify-content: center; min-width: 80px;">
            <button id="f04-change-function" class="control-btn"
                style="white-space: pre-line; line-height: 1.4; padding: 15px 12px;">Change
                Function</button>
        </div>

        <div class="control-section">
            <div class="section-title">Timer</div>
            <div class="button-row">
                <button id="f04-timer-clear" class="control-btn">Clear</button>
                <button id="f04-timer-show-tenths" class="control-btn">1/10s</button>
            </div>
            <div class="button-row">
                <button id="f04-timer-plus-1m" class="control-btn">+1m</button>
                <button id="f04-timer-minus-1m" class="control-btn">-1m</button>
                <button id="f04-timer-plus-1s" class="control-btn">+1s</button>
                <button id="f04-timer-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="f04-timer-reset" class="control-btn">Reset</button>
                <button id="f04-timer-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>
    </div>

    <!-- F05 Controls (Wrestling) -->
    <div id="controls-f05" class="controls-container" style="display: none;">
        <div class="control-section">
            <div class="section-title">Win/Wound</div>
            <div class="button-row">
                <button id="f05-win-left-plus" class="control-btn">L+1</button>
                <button id="f05-win-right-plus" class="control-btn">R+1</button>
            </div>
            <div class="button-row">
                <button id="f05-win-left-minus" class="control-btn">L-1</button>
                <button id="f05-win-right-minus" class="control-btn">R-1</button>
            </div>
            <div class="button-row">
                <button id="f05-wound-plus-1s" class="control-btn">+1s</button>
                <button id="f05-wound-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="f05-wound-left-start" class="control-btn">L-Start</button>
                <button id="f05-wound-right-start" class="control-btn">R-Start</button>
            </div>
            <div class="button-row">
                <button id="f05-wound-reset" class="control-btn full-width">Reset</button>
            </div>
        </div>

        <div class="control-section"
            style="display: flex; align-items: center; justify-content: center; min-width: 80px;">
            <button id="f05-change-function" class="control-btn"
                style="white-space: pre-line; line-height: 1.4; padding: 15px 12px;">Change
                Function</button>
        </div>

        <div class="control-section">
            <div class="section-title">Timer</div>
            <div class="button-row">
                <button id="f05-timer-clear" class="control-btn">Clear</button>
                <button id="f05-timer-show-tenths" class="control-btn">1/10s</button>
            </div>
            <div class="button-row">
                <button id="f05-timer-plus-1m" class="control-btn">+1m</button>
                <button id="f05-timer-minus-1m" class="control-btn">-1m</button>
                <button id="f05-timer-plus-1s" class="control-btn">+1s</button>
                <button id="f05-timer-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="f05-timer-reset" class="control-btn">Reset</button>
                <button id="f05-timer-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>

        <div class="control-section">
            <div class="section-title">Score</div>
            <div class="button-row">
                <button id="f05-score-left-plus" class="control-btn">L+1</button>
                <button id="f05-score-right-plus" class="control-btn">R+1</button>
            </div>
            <div class="button-row">
                <button id="f05-score-left-minus" class="control-btn">L-1</button>
                <button id="f05-score-right-minus" class="control-btn">R-1</button>
            </div>
            <div class="button-row">
                <button id="f05-score-reset" class="control-btn full-width">Reset</button>
            </div>
        </div>
    </div>

    <!-- F06 Controls (Program Timer / Repeat) -->
    <div id="controls-f06" class="controls-container" style="display: none;">
        <div class="control-section">
            <div class="section-title">Repeat counts</div>
            <div class="button-row">
                <button id="f06-repeat-plus" class="control-btn">+1</button>
                <button id="f06-repeat-minus" class="control-btn">-1</button>
            </div>
        </div>

        <div class="control-section"
            style="display: flex; align-items: center; justify-content: center; min-width: 80px;">
            <button id="f06-change-function" class="control-btn"
                style="white-space: pre-line; line-height: 1.4; padding: 15px 12px;">Change
                Function</button>
        </div>

        <div class="control-section">
            <div class="section-title">Timer</div>
            <div class="button-row">
                <button id="f06-timer-clear" class="control-btn">Clear</button>
                <button id="f06-timer-show-tenths" class="control-btn">1/10s</button>
            </div>
            <div class="button-row">
                <button id="f06-timer-plus-1m" class="control-btn">+1m</button>
                <button id="f06-timer-minus-1m" class="control-btn">-1m</button>
                <button id="f06-timer-plus-1s" class="control-btn">+1s</button>
                <button id="f06-timer-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="f06-timer-reset" class="control-btn">Reset</button>
                <button id="f06-timer-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>
    </div>

    <!-- F07 Controls (Shuttle Run) -->
    <div id="controls-f07" class="controls-container" style="display: none;">
        <div class="control-section"
            style="display: flex; align-items: center; justify-content: center; min-width: 80px;">
            <button id="f07-change-function" class="control-btn"
                style="white-space: pre-line; line-height: 1.4; padding: 15px 12px;">Change
                Function</button>
        </div>

        <div class="control-section">
            <div class="section-title">Shuttle Run</div>
            <div class="button-row">
                <button id="f07-plus-1m" class="control-btn">+1m</button>
                <button id="f07-minus-1m" class="control-btn">-1m</button>
            </div>
            <div class="button-row">
                <button id="f07-plus-1s" class="control-btn">+1s</button>
                <button id="f07-minus-1s" class="control-btn">-1s</button>
            </div>
            <div class="button-row">
                <button id="f07-plus-1step" class="control-btn full-width">+1step</button>
            </div>
            <div class="button-row">
                <button id="f07-dir-left" class="control-btn">&lt;</button>
                <button id="f07-dir-right" class="control-btn">&gt;</button>
            </div>
            <div class="button-row">
                <button id="f07-reset" class="control-btn">Reset</button>
                <button id="f07-start-stop" class="control-btn">Start/Stop</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // Firebase設定
        const firebaseConfig = {
            databaseURL: "https://molten-timer-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const stateRef = database.ref('timer-state');
        // Function modes definition
        const functionModes = [
            { code: 'F01', name: 'Basketball' },
            { code: 'F02', name: 'Volleyball, Badminton & Table tennis' },
            { code: 'F03', name: 'Judo' },
            { code: 'F04', name: 'Boxing' },
            { code: 'F05', name: 'Wrestling' },
            { code: 'F06', name: 'Program Timer' },
            { code: 'F07', name: 'Pace Maker' },
            { code: 'F08', name: '20m Shuttle run' },
            { code: 'F09', name: 'Stop Watch' },
            { code: 'F10', name: 'Timer' },
            { code: 'F11', name: 'Score Board' },
            { code: 'F12', name: 'Clock' }
        ];
        let currentFunctionIndex = 0;

        let state = {
            functionMode: 'F01',
            timerMinutes: 10,
            timerSeconds: 0,
            timerTenths: 0,
            timerRunning: false,
            timerCountUp: false,
            showTenths: false,
            timerPresetSeconds: 10 * 60,

            shotClock: 24,
            shotClockTenths: 0,
            shotClockRunning: false,
            shotClockBlank: false,
            shotClockPreset: 24,

            scoreHome: 0,
            scoreGuest: 0,
            scoreHomeBlank: false,
            scoreGuestBlank: false,

            period: null,

            arrowLeft: false,
            arrowRight: false,

            courtFlipped: false,
            hgState: 0, // 0=H/G, 1=G/H, 2=off

            // Program mode
            programMode: false,
            programNumber: 1,
            programs: [], // Array of period times in seconds

            // F02 specific
            gameSetsLeft: 0,
            gameSetsRight: 0,
            timeoutTimer: 30,
            timeoutTimerTenths: 0,
            timeoutTimerRunning: false,
            timeoutTimerBlank: true,
            timeoutTimerPreset: 30,
            // F03 specific (Judo)
            osaekomiTimer: 0,
            osaekomiTimerRunning: false,
            osaekomiTimerBlank: true,
            osaekomiIpponTime: 25,
            osaekomiWazaTime: 20,
            osaekomiSettingMode: 0, // 0=normal, 1=ippon setting, 2=waza setting
            wazaAriActive: false,
            settingBlink: false,
            // F04 specific (Boxing)
            f04Programs: [],           // [{time: 180, firstBell: 30}, ...]
            f04TotalRounds: 0,         // 設定したラウンド数
            f04CurrentRound: 1,        // 現在のラウンド
            f04CurrentProgramIndex: 0, // 現在のプログラムインデックス
            f04ProgrammingMode: false, // プログラミングモード中か
            f04ProgramStep: 'time',    // 'time' or 'firstbell'
            f04DisplayProgram: 1,      // 表示しているプログラム番号
            f04FirstBellFired: false,  // 予鈴を鳴らしたか
            f04MatchRunning: false,    // 試合進行中か
            // F05 specific (Wrestling)
            f05Programs: [],              // [{time: 180}, ...]
            f05WoundTimerPreset: 120,     // 負傷タイマープリセット(秒)
            f05FirstBellInterval: 30,     // 予鈴間隔(秒)
            f05CurrentProgramIndex: 0,
            f05ProgrammingMode: false,
            f05ProgrammingStep: 'time',   // 'time', 'wound', 'bell'
            f05DisplayProgram: 1,
            f05ScoreLeft: 0,
            f05ScoreRight: 0,
            f05WinCountLeft: null,        // null=非表示, 0-9
            f05WinCountRight: null,
            f05WoundTimerLeft: 0,
            f05WoundTimerRight: 0,
            f05WoundTimerLeftRunning: false,
            f05WoundTimerRightRunning: false,
            f05WoundDisplayLeft: false,   // 負傷タイマー表示中か
            f05WoundDisplayRight: false,
            f05MatchRunning: false,
            f05LastBellLeft: 0,           // 左の最後にブザー鳴らした秒数
            f05LastBellRight: 0,          // 右の最後にブザー鳴らした秒数
            // F06 specific (Program Timer / Repeat)
            f06Programs: [],              // [{time: 180}, ...]
            f06RepeatCount: 0,            // 0=endless, 1-99=repeat count
            f06CurrentRepeat: 1,          // 現在のリピート回数
            f06CurrentProgramIndex: 0,
            f06ProgrammingMode: false,
            f06DisplayProgram: 1,
            f06MatchRunning: false,
            // F07 specific (Shuttle Run)
            f07Countdown: 5,              // 開始前カウントダウン(秒)
            f07CountdownTenths: 0,
            f07Direction: 'right',        // 'left' or 'right'
            f07Running: false,
            f07Level: 1,                  // 現在レベル (1-40)
            f07ShuttleCount: 0,           // 現在のシャトル数 (累計)
            f07LevelShuttleCount: 0,      // レベル内シャトル数
            f07NotePosition: 0,           // 現在の音符位置 (0-8: 0=CL切り返し後, 1-7=C~B, 8=CH)
            f07ShuttleTime: 9.0,          // 現在のシャトル時間(秒)
            f07ShuttleTimeTenths: 0,      // シャトル時間のテンス
            f07ScoreMale: 1,              // 男子得点 (1-10, 11='A')
            f07ScoreFemale: 1,            // 女子得点 (1-10, 11='A')
            f07GoingRight: true,          // 現在右に向かっているか
            f07CountdownPhase: true,      // カウントダウン中か
            f07DotCount: 0                // ドット表示数 (0-8)
        };

        let timerInterval = null;
        let shotClockInterval = null;

        // Buzzer sound using Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let buzzerBuffer = null;

        // Load buzzer sound
        fetch('./Sounds/buzzer.wav')
            .then(response => {
                if (!response.ok) throw new Error('Buzzer file not found');
                return response.arrayBuffer();
            })
            .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
            .then(buffer => {
                buzzerBuffer = buffer;
                console.log('Buzzer loaded successfully');
            })
            .catch(err => console.error('Failed to load buzzer:', err));

        // Shuttle run sounds
        const shuttleNotes = ['C', 'D', 'E', 'F', 'G', 'A', 'B', 'CH', 'CL'];
        const shuttleBuffers = {};

        shuttleNotes.forEach(note => {
            fetch(`./Sounds/shuttle/${note}.wav`)
                .then(response => {
                    if (!response.ok) throw new Error(`Shuttle note ${note} not found`);
                    return response.arrayBuffer();
                })
                .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
                .then(buffer => {
                    shuttleBuffers[note] = buffer;
                    console.log(`Shuttle note ${note} loaded`);
                })
                .catch(err => console.error(`Failed to load shuttle note ${note}:`, err));
        });

        function playShuttleNote(note) {
            if (!shuttleBuffers[note]) {
                console.error(`Shuttle note ${note} not loaded`);
                return;
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            const source = audioContext.createBufferSource();
            source.buffer = shuttleBuffers[note];
            source.connect(audioContext.destination);
            source.start(0);
        }

        // Unlock AudioContext on first user interaction
        document.addEventListener('click', function unlockAudio() {
            if (audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    console.log('AudioContext resumed');
                });
            }
            document.removeEventListener('click', unlockAudio);
        }, { once: true });

        // Play buzzer once (for sub-timer)
        function playBuzzer() {
            if (!buzzerBuffer) {
                console.error('Buzzer not loaded');
                return;
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            const source = audioContext.createBufferSource();
            source.buffer = buzzerBuffer;
            source.connect(audioContext.destination);
            source.start(0);
        }

        // Play buzzer twice seamlessly (for main timer - 2x length, same pitch)
        function playDoubleBuzzer() {
            if (!buzzerBuffer) {
                console.error('Buzzer not loaded');
                return;
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            const source1 = audioContext.createBufferSource();
            const source2 = audioContext.createBufferSource();
            source1.buffer = buzzerBuffer;
            source2.buffer = buzzerBuffer;
            source1.connect(audioContext.destination);
            source2.connect(audioContext.destination);
            source1.start(0);
            source2.start(audioContext.currentTime + buzzerBuffer.duration);
        }

        const monPeriod = document.getElementById('mon-period');
        const monTimer = document.getElementById('mon-timer');
        const monShotClock = document.getElementById('mon-shot-clock');
        const monScoreHome = document.getElementById('mon-score-home');
        const monScoreGuest = document.getElementById('mon-score-guest');
        const monArrowLeft = document.getElementById('mon-arrow-left');
        const monArrowRight = document.getElementById('mon-arrow-right');

        // F02 Monitor elements
        const monF02Period = document.getElementById('mon-f02-period');
        const monF02ScoreLeft = document.getElementById('mon-f02-score-left');
        const monF02ScoreRight = document.getElementById('mon-f02-score-right');
        const monF02ArrowLeft = document.getElementById('mon-f02-arrow-left');
        const monF02ArrowRight = document.getElementById('mon-f02-arrow-right');
        const monF02SetsLeft = document.getElementById('mon-f02-sets-left');
        const monF02SetsRight = document.getElementById('mon-f02-sets-right');
        const monF02Timeout = document.getElementById('mon-f02-timeout');

        // F03 Monitor elements
        const monF03Timer = document.getElementById('mon-f03-timer');
        const monF03Waza = document.getElementById('mon-f03-waza');
        const monF03Osaekomi = document.getElementById('mon-f03-osaekomi');

        // F04 Monitor elements
        const monF04Timer = document.getElementById('mon-f04-timer');
        const monF04Round = document.getElementById('mon-f04-round');
        const monF04Program = document.getElementById('mon-f04-program');

        // F05 Monitor elements
        const monF05Period = document.getElementById('mon-f05-period');
        const monF05Timer = document.getElementById('mon-f05-timer');
        const monF05ScoreLeft = document.getElementById('mon-f05-score-left');
        const monF05ScoreRight = document.getElementById('mon-f05-score-right');
        const monF05Winner = document.getElementById('mon-f05-winner');

        // F06 Monitor elements
        const monF06Timer = document.getElementById('mon-f06-timer');
        const monF06Repeat = document.getElementById('mon-f06-repeat');
        const monF06Program = document.getElementById('mon-f06-program');

        // F07 Monitor elements
        const monF07DotCount = document.getElementById('mon-f07-dotcount');
        const monF07ArrowLeft = document.getElementById('mon-f07-arrow-left');
        const monF07ArrowRight = document.getElementById('mon-f07-arrow-right');
        const monF07Count = document.getElementById('mon-f07-count');
        const monF07Level = document.getElementById('mon-f07-level');
        const monF07ShuttleTime = document.getElementById('mon-f07-shuttletime');
        const monF07ScoreMale = document.getElementById('mon-f07-score-male');
        const monF07ScoreFemale = document.getElementById('mon-f07-score-female');

        const channel = new BroadcastChannel('basketball-timer');

        function broadcastState() {
            // BroadcastChannel（同一デバイス内用）
            channel.postMessage(state);
            // Firebase（クロスデバイス用）
            stateRef.set(state);
        }

        function updateMonitor() {
            if (state.functionMode === 'F02') {
                // F02 Monitor update
                monF02Period.textContent = state.period === null ? ' ' : state.period;

                const leftScore = state.courtFlipped ? state.scoreGuest : state.scoreHome;
                const rightScore = state.courtFlipped ? state.scoreHome : state.scoreGuest;
                monF02ScoreLeft.textContent = leftScore;
                monF02ScoreRight.textContent = rightScore;

                monF02ArrowLeft.classList.toggle('active', state.arrowLeft);
                monF02ArrowRight.classList.toggle('active', state.arrowRight);

                const gameSetsL = state.courtFlipped ? state.gameSetsRight : state.gameSetsLeft;
                const gameSetsR = state.courtFlipped ? state.gameSetsLeft : state.gameSetsRight;
                monF02SetsLeft.textContent = gameSetsL;
                monF02SetsRight.textContent = gameSetsR;

                if (state.timeoutTimerBlank) {
                    monF02Timeout.textContent = '';
                } else {
                    monF02Timeout.textContent = state.timeoutTimer;
                }
            } else if (state.functionMode === 'F03') {
                // F03 Monitor update (Judo)
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;
                if (state.showTenths && mins === 0 && secs < 60) {
                    const secsStr = secs < 10 ? ` ${secs}` : `${secs}`;
                    monF03Timer.textContent = `${secsStr}.${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    monF03Timer.textContent = `${mStr}:${sStr}`;
                }

                // W-ARI indicator
                monF03Waza.textContent = state.wazaAriActive ? '(W-ARI)' : '';

                // Osaekomi timer (with blink for setting mode)
                if (state.osaekomiTimerBlank && !state.settingBlink) {
                    monF03Osaekomi.textContent = '\u00A0';
                } else if (state.osaekomiSettingMode === 1) {
                    // Ippon time setting
                    monF03Osaekomi.textContent = state.settingBlink ? '\u00A0' : state.osaekomiIpponTime;
                } else if (state.osaekomiSettingMode === 2) {
                    // Waza time setting (blinks)
                    monF03Osaekomi.textContent = state.settingBlink ? '\u00A0' : state.osaekomiWazaTime;
                } else {
                    monF03Osaekomi.textContent = state.osaekomiTimer;
                }
            } else if (state.functionMode === 'F04') {
                // F04 Monitor update (Boxing)
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;
                if (state.showTenths && mins === 0 && secs < 60) {
                    const secsStr = secs < 10 ? ` ${secs}` : `${secs}`;
                    monF04Timer.textContent = `${secsStr}.${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    monF04Timer.textContent = `${mStr}:${sStr}`;
                }

                // Round / Program display
                if (state.f04ProgrammingMode) {
                    // Programming mode: show program number
                    monF04Round.textContent = state.f04TotalRounds;
                    if (state.f04ProgramStep === 'time') {
                        monF04Program.textContent = `P${String(state.f04DisplayProgram).padStart(2, '0')}`;
                    } else {
                        monF04Program.textContent = `F${String(state.f04DisplayProgram).padStart(2, '0')}`;
                    }
                } else if (state.f04MatchRunning || state.f04TotalRounds > 0) {
                    // Match mode: show current round
                    monF04Round.textContent = state.f04CurrentRound;
                    monF04Program.textContent = '';
                } else {
                    // Initial state
                    monF04Round.textContent = '0';
                    monF04Program.textContent = 'P01';
                }
            } else if (state.functionMode === 'F05') {
                // F05 Monitor update (Wrestling)
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;
                if (state.showTenths && mins === 0 && secs < 60) {
                    const secsStr = secs < 10 ? ` ${secs}` : `${secs}`;
                    monF05Timer.textContent = `${secsStr}.${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    monF05Timer.textContent = `${mStr}:${sStr}`;
                }

                // Period display
                monF05Period.textContent = state.f05CurrentProgramIndex + 1;

                // Score / Wound timer / Program display
                if (state.f05ProgrammingMode) {
                    if (state.f05ProgrammingStep === 'time') {
                        monF05ScoreLeft.textContent = '';
                        monF05Winner.textContent = '';
                        monF05ScoreRight.textContent = `P${String(state.f05DisplayProgram).padStart(2, '0')}`;
                    } else if (state.f05ProgrammingStep === 'wound') {
                        monF05ScoreLeft.textContent = state.f05WoundTimerPreset;
                        monF05Winner.textContent = '';
                        monF05ScoreRight.textContent = state.f05WoundTimerPreset;
                    } else if (state.f05ProgrammingStep === 'bell') {
                        monF05ScoreLeft.textContent = state.f05FirstBellInterval;
                        monF05Winner.textContent = '';
                        monF05ScoreRight.textContent = state.f05FirstBellInterval;
                    }
                } else {
                    // Match mode
                    if (state.f05WoundDisplayLeft) {
                        monF05ScoreLeft.textContent = state.f05WoundTimerLeft;
                    } else {
                        monF05ScoreLeft.textContent = state.f05ScoreLeft;
                    }

                    if (state.f05WoundDisplayRight) {
                        monF05ScoreRight.textContent = state.f05WoundTimerRight;
                    } else {
                        monF05ScoreRight.textContent = state.f05ScoreRight;
                    }

                    // Winner display (null = blank)
                    let winnerStr = '';
                    if (state.f05WinCountLeft !== null) {
                        winnerStr += state.f05WinCountLeft;
                    } else {
                        winnerStr += ' ';
                    }
                    if (state.f05WinCountRight !== null) {
                        winnerStr += state.f05WinCountRight;
                    } else {
                        winnerStr += ' ';
                    }
                    monF05Winner.textContent = winnerStr.trim() === '' ? '' : winnerStr;
                }
            } else if (state.functionMode === 'F06') {
                // F06 Monitor update (Program Timer / Repeat)
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;
                if (state.showTenths && mins === 0 && secs < 60) {
                    const secsStr = secs < 10 ? ` ${secs}` : `${secs}`;
                    monF06Timer.textContent = `${secsStr}.${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    monF06Timer.textContent = `${mStr}:${sStr}`;
                }

                // Repeat count / Program display
                if (state.f06ProgrammingMode) {
                    monF06Repeat.textContent = state.f06RepeatCount;
                    monF06Program.textContent = `P${String(state.f06DisplayProgram).padStart(2, '0')}`;
                } else if (state.f06MatchRunning) {
                    monF06Repeat.textContent = state.f06CurrentRepeat;
                    monF06Program.textContent = `P${String(state.f06CurrentProgramIndex + 1).padStart(2, '0')}`;
                } else {
                    monF06Repeat.textContent = state.f06RepeatCount;
                    monF06Program.textContent = `P${String(state.f06CurrentProgramIndex + 1).padStart(2, '0')}`;
                }
            } else if (state.functionMode === 'F07') {
                // F07 Monitor update (Shuttle Run)
                // Display countdown or shuttle count
                if (state.f07CountdownPhase) {
                    // Countdown display
                    const mins = Math.floor(state.f07Countdown / 60);
                    const secs = state.f07Countdown % 60;
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    monF07Count.textContent = `${mStr}:${sStr}`;
                } else {
                    // Shuttle count display
                    monF07Count.textContent = state.f07ShuttleCount;
                }

                // Arrows based on direction and going direction
                if (state.f07CountdownPhase) {
                    // Before start: show intended direction
                    monF07ArrowLeft.style.visibility = state.f07Direction === 'left' ? 'visible' : 'hidden';
                    monF07ArrowRight.style.visibility = state.f07Direction === 'right' ? 'visible' : 'hidden';
                } else {
                    // During run: show current direction
                    monF07ArrowLeft.style.visibility = !state.f07GoingRight ? 'visible' : 'hidden';
                    monF07ArrowRight.style.visibility = state.f07GoingRight ? 'visible' : 'hidden';
                }

                // Dot count (note position indicator)
                monF07DotCount.textContent = state.f07DotCount;

                // Level
                monF07Level.textContent = state.f07Level;

                // Shuttle time
                const shuttleTimeInt = Math.floor(state.f07ShuttleTime);
                const shuttleTimeFrac = Math.round((state.f07ShuttleTime - shuttleTimeInt) * 10);
                monF07ShuttleTime.textContent = `${shuttleTimeInt}.${shuttleTimeFrac}`;

                // Scores
                monF07ScoreMale.textContent = state.f07ScoreMale === 11 ? 'A' : state.f07ScoreMale;
                monF07ScoreFemale.textContent = state.f07ScoreFemale === 11 ? 'A' : state.f07ScoreFemale;
            } else {
                // F01 Monitor update (original behavior)
                monPeriod.textContent = state.period === null ? ' ' : state.period;

                const mins = state.timerMinutes;
                const secs = state.timerSeconds;
                if (state.showTenths && mins === 0 && secs < 60) {
                    const secsStr = secs < 10 ? ` ${secs}` : `${secs}`;
                    monTimer.textContent = `${secsStr}.${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    monTimer.textContent = `${mStr}:${sStr}`;
                }

                if (state.shotClockBlank) {
                    monShotClock.textContent = '';
                } else if (state.shotClock < 10) {
                    monShotClock.textContent = `${state.shotClock}.${state.shotClockTenths}`;
                } else {
                    monShotClock.textContent = `${state.shotClock}`;
                }

                if (state.programMode) {
                    monScoreHome.textContent = '';
                    monScoreGuest.textContent = `P${String(state.programNumber).padStart(2, '0')}`;
                } else {
                    const leftScore = state.courtFlipped ? state.scoreGuest : state.scoreHome;
                    const rightScore = state.courtFlipped ? state.scoreHome : state.scoreGuest;
                    const leftBlank = state.courtFlipped ? state.scoreGuestBlank : state.scoreHomeBlank;
                    const rightBlank = state.courtFlipped ? state.scoreHomeBlank : state.scoreGuestBlank;
                    monScoreHome.textContent = leftBlank ? '' : leftScore;
                    monScoreGuest.textContent = rightBlank ? '' : rightScore;
                }

                monArrowLeft.classList.toggle('active', state.arrowLeft);
                monArrowRight.classList.toggle('active', state.arrowRight);
            }

            broadcastState();
        }

        function timerTick() {
            if (state.timerCountUp) {
                state.timerTenths++;
                if (state.timerTenths >= 10) {
                    state.timerTenths = 0;
                    state.timerSeconds++;
                    if (state.timerSeconds >= 60) {
                        state.timerSeconds = 0;
                        state.timerMinutes++;
                    }
                }
                const totalSecs = state.timerMinutes * 60 + state.timerSeconds;
                if (totalSecs >= state.timerPresetSeconds) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    state.timerRunning = false;
                    document.getElementById('timer-start-stop').classList.remove('toggled');
                    playDoubleBuzzer();
                }
            } else {
                if (state.timerMinutes === 0 && state.timerSeconds === 0 && state.timerTenths === 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    state.timerRunning = false;
                    document.getElementById('timer-start-stop').classList.remove('toggled');
                    playDoubleBuzzer();
                } else {
                    state.timerTenths--;
                    if (state.timerTenths < 0) {
                        state.timerTenths = 9;
                        state.timerSeconds--;
                        if (state.timerSeconds < 0) {
                            state.timerSeconds = 59;
                            state.timerMinutes = Math.max(0, state.timerMinutes - 1);
                        }
                    }
                }
            }
            updateMonitor();
        }

        function shotClockTick() {
            state.shotClockTenths--;
            if (state.shotClockTenths < 0) {
                state.shotClockTenths = 9;
                state.shotClock--;
            }
            if (state.shotClock < 0) {
                state.shotClock = 0;
                state.shotClockTenths = 0;
                clearInterval(shotClockInterval);
                shotClockInterval = null;
                state.shotClockRunning = false;
                document.getElementById('sub-start-stop').classList.remove('toggled');
                playBuzzer();
            }
            updateMonitor();
        }

        // Sub-Timer buttons
        document.getElementById('sub-clear').addEventListener('click', () => {
            state.shotClock = 0;
            state.shotClockTenths = 0;
            state.shotClockBlank = false;
            updateMonitor();
        });

        document.getElementById('sub-toggle-time').addEventListener('click', () => {
            state.shotClockPreset = state.shotClockPreset === 24 ? 30 : 24;
            document.getElementById('sub-toggle-time').textContent = `${state.shotClockPreset}/${state.shotClockPreset === 24 ? 30 : 24}`;
            updateMonitor();
        });

        document.getElementById('sub-plus-1s').addEventListener('click', () => {
            state.shotClockBlank = false;
            state.shotClock = Math.min(99, state.shotClock + 1);
            updateMonitor();
        });

        document.getElementById('sub-minus-1s').addEventListener('click', () => {
            if (state.shotClock === 0 && state.shotClockTenths === 0) {
                state.shotClockBlank = true;
            } else {
                state.shotClock = Math.max(0, state.shotClock - 1);
            }
            updateMonitor();
        });

        const sub14sBtn = document.getElementById('sub-14s-start');
        sub14sBtn.addEventListener('mousedown', () => {
            state.shotClockBlank = true;
            sub14sBtn.classList.add('hold-active');
            updateMonitor();
        });
        sub14sBtn.addEventListener('mouseup', () => {
            state.shotClockBlank = false;
            state.shotClock = 14;
            state.shotClockTenths = 0;
            sub14sBtn.classList.remove('hold-active');
            if (!state.shotClockRunning) {
                state.shotClockRunning = true;
                shotClockInterval = setInterval(shotClockTick, 100);
                document.getElementById('sub-start-stop').classList.add('toggled');
            }
            updateMonitor();
        });
        sub14sBtn.addEventListener('mouseleave', () => {
            if (state.shotClockBlank) {
                state.shotClockBlank = false;
                state.shotClock = 14;
                state.shotClockTenths = 0;
                updateMonitor();
            }
            sub14sBtn.classList.remove('hold-active');
        });

        const subResetBtn = document.getElementById('sub-reset');
        subResetBtn.addEventListener('mousedown', () => {
            state.shotClockBlank = true;
            subResetBtn.classList.add('hold-active');
            updateMonitor();
        });
        subResetBtn.addEventListener('mouseup', () => {
            state.shotClockBlank = false;
            state.shotClock = state.shotClockPreset;
            state.shotClockTenths = 0;
            subResetBtn.classList.remove('hold-active');
            if (!state.shotClockRunning) {
                state.shotClockRunning = true;
                shotClockInterval = setInterval(shotClockTick, 100);
                document.getElementById('sub-start-stop').classList.add('toggled');
            }
            updateMonitor();
        });
        subResetBtn.addEventListener('mouseleave', () => {
            if (state.shotClockBlank) {
                state.shotClockBlank = false;
                state.shotClock = state.shotClockPreset;
                state.shotClockTenths = 0;
                updateMonitor();
            }
            subResetBtn.classList.remove('hold-active');
        });

        document.getElementById('sub-start-stop').addEventListener('click', () => {
            if (state.shotClockRunning) {
                clearInterval(shotClockInterval);
                shotClockInterval = null;
                state.shotClockRunning = false;
            } else {
                state.shotClockRunning = true;
                shotClockInterval = setInterval(shotClockTick, 100);
            }
            document.getElementById('sub-start-stop').classList.toggle('toggled', state.shotClockRunning);
            updateMonitor();
        });

        // Timer buttons
        document.getElementById('timer-clear').addEventListener('click', () => {
            state.timerMinutes = 0;
            state.timerSeconds = 0;
            state.timerTenths = 0;
            updateMonitor();
        });

        document.getElementById('timer-count-mode').addEventListener('click', () => {
            state.timerCountUp = !state.timerCountUp;
            const btn = document.getElementById('timer-count-mode');
            btn.classList.toggle('toggled', state.timerCountUp);
            btn.textContent = state.timerCountUp ? 'Up' : 'Down';
            if (state.timerCountUp) {
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
            }
            updateMonitor();
        });

        document.getElementById('timer-show-tenths').addEventListener('click', () => {
            state.showTenths = !state.showTenths;
            document.getElementById('timer-show-tenths').classList.toggle('toggled', state.showTenths);
            updateMonitor();
        });

        document.getElementById('timer-plus-1m').addEventListener('click', () => {
            state.timerMinutes = Math.min(99, state.timerMinutes + 1);
            if (!state.timerCountUp) state.timerPresetSeconds = state.timerMinutes * 60 + state.timerSeconds;
            updateMonitor();
        });

        document.getElementById('timer-minus-1m').addEventListener('click', () => {
            state.timerMinutes = Math.max(0, state.timerMinutes - 1);
            if (!state.timerCountUp) state.timerPresetSeconds = state.timerMinutes * 60 + state.timerSeconds;
            updateMonitor();
        });

        document.getElementById('timer-plus-1s').addEventListener('click', () => {
            state.timerSeconds++;
            if (state.timerSeconds >= 60) { state.timerSeconds = 0; state.timerMinutes = Math.min(99, state.timerMinutes + 1); }
            if (!state.timerCountUp) state.timerPresetSeconds = state.timerMinutes * 60 + state.timerSeconds;
            updateMonitor();
        });

        document.getElementById('timer-minus-1s').addEventListener('click', () => {
            state.timerSeconds--;
            if (state.timerSeconds < 0) { state.timerSeconds = 59; state.timerMinutes = Math.max(0, state.timerMinutes - 1); }
            if (!state.timerCountUp) state.timerPresetSeconds = state.timerMinutes * 60 + state.timerSeconds;
            updateMonitor();
        });

        document.getElementById('timer-plus-tenth').addEventListener('click', () => {
            state.timerTenths++;
            if (state.timerTenths >= 10) { state.timerTenths = 0; state.timerSeconds++; if (state.timerSeconds >= 60) { state.timerSeconds = 0; state.timerMinutes++; } }
            updateMonitor();
        });

        document.getElementById('timer-minus-tenth').addEventListener('click', () => {
            state.timerTenths--;
            if (state.timerTenths < 0) { state.timerTenths = 9; state.timerSeconds--; if (state.timerSeconds < 0) { state.timerSeconds = 59; state.timerMinutes--; } }
            updateMonitor();
        });

        // Timer Reset - handles program mode
        document.getElementById('timer-reset').addEventListener('click', () => {
            const currentTimeSeconds = state.timerMinutes * 60 + state.timerSeconds;

            if (!state.programMode) {
                // Not in program mode
                if (currentTimeSeconds > 0) {
                    // Time is set - enter program mode
                    state.programs = [currentTimeSeconds];
                    state.programMode = true;
                    state.programNumber = 2;
                    state.timerMinutes = 0;
                    state.timerSeconds = 0;
                    state.timerTenths = 0;
                } else {
                    // Already 0, just reset
                    state.timerMinutes = Math.floor(state.timerPresetSeconds / 60);
                    state.timerSeconds = state.timerPresetSeconds % 60;
                    state.timerTenths = 0;
                }
            } else {
                // In program mode
                if (currentTimeSeconds > 0) {
                    // Add this time to programs
                    state.programs.push(currentTimeSeconds);
                    state.programNumber++;
                    state.timerMinutes = 0;
                    state.timerSeconds = 0;
                    state.timerTenths = 0;
                } else {
                    // Timer is 0 - confirm and exit program mode
                    state.programMode = false;
                    // Set timer to first program
                    if (state.programs.length > 0) {
                        const firstProgram = state.programs[0];
                        state.timerMinutes = Math.floor(firstProgram / 60);
                        state.timerSeconds = firstProgram % 60;
                        state.timerPresetSeconds = firstProgram;
                    }
                    state.programNumber = 1;
                }
            }
            updateMonitor();
        });

        document.getElementById('timer-start-stop').addEventListener('click', () => {
            if (state.timerRunning) {
                clearInterval(timerInterval);
                timerInterval = null;
                state.timerRunning = false;
            } else {
                state.timerRunning = true;
                timerInterval = setInterval(timerTick, 100);
            }
            document.getElementById('timer-start-stop').classList.toggle('toggled', state.timerRunning);
            updateMonitor();
        });

        // Score buttons
        document.getElementById('score-hg-toggle').addEventListener('click', () => {
            state.hgState = (state.hgState + 1) % 3;
            const btn = document.getElementById('score-hg-toggle');
            btn.classList.remove('toggled', 'active-green');
            if (state.hgState === 0) btn.textContent = 'H/G';
            else if (state.hgState === 1) { btn.textContent = 'G/H'; btn.classList.add('toggled'); }
            else { btn.textContent = 'Off'; }
            updateMonitor();
        });

        document.getElementById('score-court-change').addEventListener('click', () => {
            state.courtFlipped = !state.courtFlipped;
            [state.arrowLeft, state.arrowRight] = [state.arrowRight, state.arrowLeft];
            // Also swap H/G if not off
            if (state.hgState !== 2) {
                state.hgState = state.hgState === 0 ? 1 : 0;
                const btn = document.getElementById('score-hg-toggle');
                if (state.hgState === 0) { btn.textContent = 'H/G'; btn.classList.remove('toggled'); }
                else { btn.textContent = 'G/H'; btn.classList.add('toggled'); }
            }
            document.getElementById('score-court-change').classList.toggle('toggled', state.courtFlipped);
            updateMonitor();
        });

        document.getElementById('score-arrow-left').addEventListener('click', () => {
            if (state.arrowLeft) { state.arrowLeft = false; }
            else { state.arrowLeft = true; state.arrowRight = false; }
            document.getElementById('score-arrow-left').classList.toggle('toggled', state.arrowLeft);
            document.getElementById('score-arrow-right').classList.toggle('toggled', state.arrowRight);
            updateMonitor();
        });

        document.getElementById('score-arrow-right').addEventListener('click', () => {
            if (state.arrowRight) { state.arrowRight = false; }
            else { state.arrowRight = true; state.arrowLeft = false; }
            document.getElementById('score-arrow-left').classList.toggle('toggled', state.arrowLeft);
            document.getElementById('score-arrow-right').classList.toggle('toggled', state.arrowRight);
            updateMonitor();
        });

        document.getElementById('score-period').addEventListener('click', () => {
            const cycle = [null, 1, 2, 3, 4, 5, 'E'];
            const idx = cycle.indexOf(state.period);
            state.period = cycle[(idx + 1) % cycle.length];
            updateMonitor();
        });

        document.getElementById('score-left-plus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.scoreGuestBlank = false;
                state.scoreGuest = Math.min(199, state.scoreGuest + 1);
            } else {
                state.scoreHomeBlank = false;
                state.scoreHome = Math.min(199, state.scoreHome + 1);
            }
            updateMonitor();
        });

        document.getElementById('score-right-plus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.scoreHomeBlank = false;
                state.scoreHome = Math.min(199, state.scoreHome + 1);
            } else {
                state.scoreGuestBlank = false;
                state.scoreGuest = Math.min(199, state.scoreGuest + 1);
            }
            updateMonitor();
        });

        document.getElementById('score-left-minus').addEventListener('click', () => {
            if (state.courtFlipped) {
                if (state.scoreGuest === 0) { state.scoreGuestBlank = true; }
                else { state.scoreGuest = Math.max(0, state.scoreGuest - 1); }
            } else {
                if (state.scoreHome === 0) { state.scoreHomeBlank = true; }
                else { state.scoreHome = Math.max(0, state.scoreHome - 1); }
            }
            updateMonitor();
        });

        document.getElementById('score-right-minus').addEventListener('click', () => {
            if (state.courtFlipped) {
                if (state.scoreHome === 0) { state.scoreHomeBlank = true; }
                else { state.scoreHome = Math.max(0, state.scoreHome - 1); }
            } else {
                if (state.scoreGuest === 0) { state.scoreGuestBlank = true; }
                else { state.scoreGuest = Math.max(0, state.scoreGuest - 1); }
            }
            updateMonitor();
        });

        document.getElementById('score-reset').addEventListener('click', () => {
            state.scoreHome = 0;
            state.scoreGuest = 0;
            state.scoreHomeBlank = false;
            state.scoreGuestBlank = false;
            updateMonitor();
        });

        // Change Function - shared logic
        function switchFunctionMode() {
            currentFunctionIndex = (currentFunctionIndex + 1) % functionModes.length;
            const mode = functionModes[currentFunctionIndex];
            document.querySelector('h1').textContent = `${mode.code} ${mode.name}`;

            // Update state with function mode
            state.functionMode = mode.code;

            // Toggle UI visibility
            document.getElementById('monitor-f01').style.display = mode.code === 'F01' ? 'block' : 'none';
            document.getElementById('monitor-f02').style.display = mode.code === 'F02' ? 'block' : 'none';
            document.getElementById('monitor-f03').style.display = mode.code === 'F03' ? 'block' : 'none';
            document.getElementById('monitor-f04').style.display = mode.code === 'F04' ? 'block' : 'none';
            document.getElementById('monitor-f05').style.display = mode.code === 'F05' ? 'block' : 'none';
            document.getElementById('monitor-f06').style.display = mode.code === 'F06' ? 'block' : 'none';
            document.getElementById('monitor-f07').style.display = mode.code === 'F07' ? 'block' : 'none';
            document.getElementById('controls-f01').style.display = mode.code === 'F01' ? 'flex' : 'none';
            document.getElementById('controls-f02').style.display = mode.code === 'F02' ? 'flex' : 'none';
            document.getElementById('controls-f03').style.display = mode.code === 'F03' ? 'flex' : 'none';
            document.getElementById('controls-f04').style.display = mode.code === 'F04' ? 'flex' : 'none';
            document.getElementById('controls-f05').style.display = mode.code === 'F05' ? 'flex' : 'none';
            document.getElementById('controls-f06').style.display = mode.code === 'F06' ? 'flex' : 'none';
            document.getElementById('controls-f07').style.display = mode.code === 'F07' ? 'flex' : 'none';

            updateMonitor();
        }

        // Change Function buttons (F01, F02, F03, F04, F05, F06, F07)
        document.getElementById('change-function').addEventListener('click', switchFunctionMode);
        document.getElementById('f02-change-function').addEventListener('click', switchFunctionMode);
        document.getElementById('f03-change-function').addEventListener('click', switchFunctionMode);
        document.getElementById('f04-change-function').addEventListener('click', switchFunctionMode);
        document.getElementById('f05-change-function').addEventListener('click', switchFunctionMode);
        document.getElementById('f06-change-function').addEventListener('click', switchFunctionMode);
        document.getElementById('f07-change-function').addEventListener('click', switchFunctionMode);

        // =====================
        // F02 Event Handlers
        // =====================

        let timeoutTimerInterval = null;

        function timeoutTimerTick() {
            state.timeoutTimerTenths--;
            if (state.timeoutTimerTenths < 0) {
                state.timeoutTimerTenths = 9;
                state.timeoutTimer--;
            }
            if (state.timeoutTimer < 0) {
                state.timeoutTimer = 0;
                state.timeoutTimerTenths = 0;
                clearInterval(timeoutTimerInterval);
                timeoutTimerInterval = null;
                state.timeoutTimerRunning = false;
                document.getElementById('f02-timeout-start-stop').classList.remove('toggled');
                playBuzzer();
                state.timeoutTimerBlank = true;
            }
            updateMonitor();
        }

        // Timeout Timer - +1s (shows timer for adjustment)
        document.getElementById('f02-timeout-plus-1s').addEventListener('click', () => {
            state.timeoutTimerBlank = false;
            state.timeoutTimer = Math.min(99, state.timeoutTimer + 1);
            updateMonitor();
        });

        // Timeout Timer - -1s (shows timer for adjustment)
        document.getElementById('f02-timeout-minus-1s').addEventListener('click', () => {
            state.timeoutTimerBlank = false;
            state.timeoutTimer = Math.max(0, state.timeoutTimer - 1);
            updateMonitor();
        });

        // Timeout Timer - Reset (memorizes time or blanks after stop)
        document.getElementById('f02-timeout-reset').addEventListener('click', () => {
            if (state.timeoutTimerRunning) {
                // Timer is running - do nothing, must stop first
                return;
            }
            if (!state.timeoutTimerBlank) {
                // Timer was adjusted/stopped - memorize preset and blank
                state.timeoutTimerPreset = state.timeoutTimer;
                state.timeoutTimerBlank = true;
            } else {
                // Timer is blank - reset to preset and keep blank
                state.timeoutTimer = state.timeoutTimerPreset;
                state.timeoutTimerTenths = 0;
            }
            updateMonitor();
        });

        // Timeout Timer - Start/Stop
        document.getElementById('f02-timeout-start-stop').addEventListener('click', () => {
            if (state.timeoutTimerRunning) {
                clearInterval(timeoutTimerInterval);
                timeoutTimerInterval = null;
                state.timeoutTimerRunning = false;
            } else {
                state.timeoutTimerBlank = false;
                state.timeoutTimerRunning = true;
                timeoutTimerInterval = setInterval(timeoutTimerTick, 100);
            }
            document.getElementById('f02-timeout-start-stop').classList.toggle('toggled', state.timeoutTimerRunning);
            updateMonitor();
        });

        // F02 Score - Arrow Left (Serve)
        document.getElementById('f02-score-arrow-left').addEventListener('click', () => {
            if (state.arrowLeft) { state.arrowLeft = false; }
            else { state.arrowLeft = true; state.arrowRight = false; }
            document.getElementById('f02-score-arrow-left').classList.toggle('toggled', state.arrowLeft);
            document.getElementById('f02-score-arrow-right').classList.toggle('toggled', state.arrowRight);
            updateMonitor();
        });

        // F02 Score - Arrow Right (Serve)
        document.getElementById('f02-score-arrow-right').addEventListener('click', () => {
            if (state.arrowRight) { state.arrowRight = false; }
            else { state.arrowRight = true; state.arrowLeft = false; }
            document.getElementById('f02-score-arrow-left').classList.toggle('toggled', state.arrowLeft);
            document.getElementById('f02-score-arrow-right').classList.toggle('toggled', state.arrowRight);
            updateMonitor();
        });

        // F02 Score - Period
        document.getElementById('f02-score-period').addEventListener('click', () => {
            const cycle = [null, 1, 2, 3, 4, 5, 'E'];
            const idx = cycle.indexOf(state.period);
            state.period = cycle[(idx + 1) % cycle.length];
            updateMonitor();
        });

        // F02 Score - L+1
        document.getElementById('f02-score-left-plus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.scoreGuest = Math.min(99, state.scoreGuest + 1);
            } else {
                state.scoreHome = Math.min(99, state.scoreHome + 1);
            }
            updateMonitor();
        });

        // F02 Score - R+1
        document.getElementById('f02-score-right-plus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.scoreHome = Math.min(99, state.scoreHome + 1);
            } else {
                state.scoreGuest = Math.min(99, state.scoreGuest + 1);
            }
            updateMonitor();
        });

        // F02 Score - L-1
        document.getElementById('f02-score-left-minus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.scoreGuest = Math.max(0, state.scoreGuest - 1);
            } else {
                state.scoreHome = Math.max(0, state.scoreHome - 1);
            }
            updateMonitor();
        });

        // F02 Score - R-1
        document.getElementById('f02-score-right-minus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.scoreHome = Math.max(0, state.scoreHome - 1);
            } else {
                state.scoreGuest = Math.max(0, state.scoreGuest - 1);
            }
            updateMonitor();
        });

        // F02 Score - Reset
        document.getElementById('f02-score-reset').addEventListener('click', () => {
            state.scoreHome = 0;
            state.scoreGuest = 0;
            updateMonitor();
        });

        // F02 Game Sets - L+1
        document.getElementById('f02-sets-left-plus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.gameSetsRight = Math.min(9, state.gameSetsRight + 1);
            } else {
                state.gameSetsLeft = Math.min(9, state.gameSetsLeft + 1);
            }
            updateMonitor();
        });

        // F02 Game Sets - R+1
        document.getElementById('f02-sets-right-plus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.gameSetsLeft = Math.min(9, state.gameSetsLeft + 1);
            } else {
                state.gameSetsRight = Math.min(9, state.gameSetsRight + 1);
            }
            updateMonitor();
        });

        // F02 Game Sets - L-1
        document.getElementById('f02-sets-left-minus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.gameSetsRight = Math.max(0, state.gameSetsRight - 1);
            } else {
                state.gameSetsLeft = Math.max(0, state.gameSetsLeft - 1);
            }
            updateMonitor();
        });

        // F02 Game Sets - R-1
        document.getElementById('f02-sets-right-minus').addEventListener('click', () => {
            if (state.courtFlipped) {
                state.gameSetsLeft = Math.max(0, state.gameSetsLeft - 1);
            } else {
                state.gameSetsRight = Math.max(0, state.gameSetsRight - 1);
            }
            updateMonitor();
        });

        // F02 Game Sets - Reset
        document.getElementById('f02-sets-reset').addEventListener('click', () => {
            state.gameSetsLeft = 0;
            state.gameSetsRight = 0;
            updateMonitor();
        });

        // =====================
        // F03 Event Handlers (Judo)
        // =====================

        let osaekomiInterval = null;
        let settingBlinkInterval = null;
        let f03TimerInterval = null;

        function osaekomiTick() {
            state.osaekomiTimer++;
            const targetTime = state.wazaAriActive ? state.osaekomiWazaTime : state.osaekomiIpponTime;

            if (state.osaekomiTimer >= targetTime) {
                // Reached target time - stop both timers, buzzer
                clearInterval(osaekomiInterval);
                osaekomiInterval = null;
                state.osaekomiTimerRunning = false;

                // Also stop match timer
                if (f03TimerInterval) {
                    clearInterval(f03TimerInterval);
                    f03TimerInterval = null;
                    state.timerRunning = false;
                    document.getElementById('f03-timer-start-stop').classList.remove('toggled');
                }

                document.getElementById('f03-osaekomi-start-stop').classList.remove('toggled');
                playDoubleBuzzer();
                state.osaekomiTimerBlank = true;
            }
            updateMonitor();
        }

        function f03TimerTick() {
            if (state.timerCountUp) {
                state.timerTenths++;
                if (state.timerTenths >= 10) {
                    state.timerTenths = 0;
                    state.timerSeconds++;
                    if (state.timerSeconds >= 60) {
                        state.timerSeconds = 0;
                        state.timerMinutes++;
                    }
                }
            } else {
                if (state.timerMinutes === 0 && state.timerSeconds === 0 && state.timerTenths === 0) {
                    // Time's up - but only sound buzzer if osaekomi is not running
                    if (!state.osaekomiTimerRunning) {
                        clearInterval(f03TimerInterval);
                        f03TimerInterval = null;
                        state.timerRunning = false;
                        document.getElementById('f03-timer-start-stop').classList.remove('toggled');
                        playDoubleBuzzer();
                    }
                    // If osaekomi is running, just stop the timer silently
                    else {
                        clearInterval(f03TimerInterval);
                        f03TimerInterval = null;
                        state.timerRunning = false;
                        document.getElementById('f03-timer-start-stop').classList.remove('toggled');
                    }
                } else {
                    state.timerTenths--;
                    if (state.timerTenths < 0) {
                        state.timerTenths = 9;
                        state.timerSeconds--;
                        if (state.timerSeconds < 0) {
                            state.timerSeconds = 59;
                            state.timerMinutes = Math.max(0, state.timerMinutes - 1);
                        }
                    }
                }
            }
            updateMonitor();
        }

        // Waza On - enable waza-ari mode (only when osaekomi is running)
        document.getElementById('f03-waza-on').addEventListener('click', () => {
            if (state.osaekomiTimerRunning) {
                state.wazaAriActive = true;
                document.getElementById('f03-waza-on').classList.add('toggled');
                document.getElementById('f03-waza-off').classList.remove('toggled');
                updateMonitor();
            }
        });

        // Waza Off - disable waza-ari mode
        document.getElementById('f03-waza-off').addEventListener('click', () => {
            if (state.osaekomiTimerRunning) {
                state.wazaAriActive = false;
                document.getElementById('f03-waza-on').classList.remove('toggled');
                document.getElementById('f03-waza-off').classList.add('toggled');
                updateMonitor();
            }
        });

        // F03 Timer Controls
        document.getElementById('f03-timer-clear').addEventListener('click', () => {
            state.timerMinutes = 0;
            state.timerSeconds = 0;
            state.timerTenths = 0;
            updateMonitor();
        });

        document.getElementById('f03-timer-count-mode').addEventListener('click', () => {
            state.timerCountUp = !state.timerCountUp;
            const btn = document.getElementById('f03-timer-count-mode');
            btn.classList.toggle('toggled', state.timerCountUp);
            btn.textContent = state.timerCountUp ? 'Up' : 'Down';
            if (state.timerCountUp) {
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
            }
            updateMonitor();
        });

        document.getElementById('f03-timer-show-tenths').addEventListener('click', () => {
            state.showTenths = !state.showTenths;
            document.getElementById('f03-timer-show-tenths').classList.toggle('toggled', state.showTenths);
            updateMonitor();
        });

        document.getElementById('f03-timer-plus-1m').addEventListener('click', () => {
            state.timerMinutes = Math.min(99, state.timerMinutes + 1);
            if (!state.timerCountUp) state.timerPresetSeconds = state.timerMinutes * 60 + state.timerSeconds;
            updateMonitor();
        });

        document.getElementById('f03-timer-minus-1m').addEventListener('click', () => {
            state.timerMinutes = Math.max(0, state.timerMinutes - 1);
            if (!state.timerCountUp) state.timerPresetSeconds = state.timerMinutes * 60 + state.timerSeconds;
            updateMonitor();
        });

        document.getElementById('f03-timer-plus-1s').addEventListener('click', () => {
            state.timerSeconds++;
            if (state.timerSeconds >= 60) { state.timerSeconds = 0; state.timerMinutes = Math.min(99, state.timerMinutes + 1); }
            if (!state.timerCountUp) state.timerPresetSeconds = state.timerMinutes * 60 + state.timerSeconds;
            updateMonitor();
        });

        document.getElementById('f03-timer-minus-1s').addEventListener('click', () => {
            state.timerSeconds--;
            if (state.timerSeconds < 0) { state.timerSeconds = 59; state.timerMinutes = Math.max(0, state.timerMinutes - 1); }
            if (!state.timerCountUp) state.timerPresetSeconds = state.timerMinutes * 60 + state.timerSeconds;
            updateMonitor();
        });

        document.getElementById('f03-timer-plus-tenth').addEventListener('click', () => {
            state.timerTenths++;
            if (state.timerTenths >= 10) { state.timerTenths = 0; state.timerSeconds++; if (state.timerSeconds >= 60) { state.timerSeconds = 0; state.timerMinutes++; } }
            updateMonitor();
        });

        document.getElementById('f03-timer-minus-tenth').addEventListener('click', () => {
            state.timerTenths--;
            if (state.timerTenths < 0) { state.timerTenths = 9; state.timerSeconds--; if (state.timerSeconds < 0) { state.timerSeconds = 59; state.timerMinutes--; } }
            updateMonitor();
        });

        document.getElementById('f03-timer-reset').addEventListener('click', () => {
            state.timerMinutes = Math.floor(state.timerPresetSeconds / 60);
            state.timerSeconds = state.timerPresetSeconds % 60;
            state.timerTenths = 0;
            updateMonitor();
        });

        document.getElementById('f03-timer-start-stop').addEventListener('click', () => {
            if (state.timerRunning) {
                clearInterval(f03TimerInterval);
                f03TimerInterval = null;
                state.timerRunning = false;

                // Also stop osaekomi timer when match timer stops
                if (osaekomiInterval) {
                    clearInterval(osaekomiInterval);
                    osaekomiInterval = null;
                    state.osaekomiTimerRunning = false;
                    state.osaekomiTimer = 0;
                    state.osaekomiTimerBlank = true;
                    state.wazaAriActive = false;
                    document.getElementById('f03-osaekomi-start-stop').classList.remove('toggled');
                    document.getElementById('f03-waza-on').classList.remove('toggled');
                    document.getElementById('f03-waza-off').classList.remove('toggled');
                    playBuzzer();
                }
            } else {
                state.timerRunning = true;
                f03TimerInterval = setInterval(f03TimerTick, 100);
            }
            document.getElementById('f03-timer-start-stop').classList.toggle('toggled', state.timerRunning);
            updateMonitor();
        });

        // Osae-komi Controls
        document.getElementById('f03-osaekomi-plus-1s').addEventListener('click', () => {
            if (state.osaekomiSettingMode === 2) {
                state.osaekomiWazaTime = Math.min(99, state.osaekomiWazaTime + 1);
            } else {
                state.osaekomiSettingMode = 1;
                state.osaekomiTimerBlank = false;
                state.osaekomiIpponTime = Math.min(99, state.osaekomiIpponTime + 1);
            }
            updateMonitor();
        });

        document.getElementById('f03-osaekomi-minus-1s').addEventListener('click', () => {
            if (state.osaekomiSettingMode === 2) {
                state.osaekomiWazaTime = Math.max(1, state.osaekomiWazaTime - 1);
            } else {
                state.osaekomiSettingMode = 1;
                state.osaekomiTimerBlank = false;
                state.osaekomiIpponTime = Math.max(1, state.osaekomiIpponTime - 1);
            }
            updateMonitor();
        });

        document.getElementById('f03-osaekomi-reset').addEventListener('click', () => {
            if (state.osaekomiTimerRunning) return;

            if (state.osaekomiSettingMode === 0 || state.osaekomiSettingMode === 1) {
                // Switch to waza time setting mode (blink)
                state.osaekomiSettingMode = 2;
                state.osaekomiTimerBlank = false;
                settingBlinkInterval = setInterval(() => {
                    state.settingBlink = !state.settingBlink;
                    updateMonitor();
                }, 500);
            } else if (state.osaekomiSettingMode === 2) {
                // Confirm and exit setting mode
                state.osaekomiSettingMode = 0;
                state.osaekomiTimerBlank = true;
                state.settingBlink = false;
                if (settingBlinkInterval) {
                    clearInterval(settingBlinkInterval);
                    settingBlinkInterval = null;
                }
            }
            updateMonitor();
        });

        document.getElementById('f03-osaekomi-start-stop').addEventListener('click', () => {
            // Exit setting mode if active
            if (state.osaekomiSettingMode !== 0) {
                state.osaekomiSettingMode = 0;
                state.settingBlink = false;
                if (settingBlinkInterval) {
                    clearInterval(settingBlinkInterval);
                    settingBlinkInterval = null;
                }
            }

            if (state.osaekomiTimerRunning) {
                // Stop osaekomi
                clearInterval(osaekomiInterval);
                osaekomiInterval = null;
                state.osaekomiTimerRunning = false;
                state.osaekomiTimer = 0;
                state.osaekomiTimerBlank = true;
                state.wazaAriActive = false;
                document.getElementById('f03-waza-on').classList.remove('toggled');
                document.getElementById('f03-waza-off').classList.remove('toggled');

                // If match timer already at 0, sound buzzer for match end
                if (state.timerMinutes === 0 && state.timerSeconds === 0 && state.timerTenths === 0) {
                    playDoubleBuzzer();
                }
            } else {
                // Start osaekomi (only if match timer is running or at 0 in osaekomi)
                state.osaekomiTimer = 0;
                state.osaekomiTimerBlank = false;
                state.osaekomiTimerRunning = true;
                osaekomiInterval = setInterval(osaekomiTick, 1000);
            }
            document.getElementById('f03-osaekomi-start-stop').classList.toggle('toggled', state.osaekomiTimerRunning);
            updateMonitor();
        });

        // =====================
        // F04 Event Handlers (Boxing)
        // =====================

        let f04TimerInterval = null;

        function f04TimerTick() {
            // Check for first bell
            if (!state.f04FirstBellFired && state.f04Programs.length > 0) {
                const currentProg = state.f04Programs[state.f04CurrentProgramIndex];
                if (currentProg && currentProg.firstBell > 0) {
                    const currentSecs = state.timerMinutes * 60 + state.timerSeconds;
                    if (currentSecs <= currentProg.firstBell && currentSecs > 0) {
                        state.f04FirstBellFired = true;
                        playBuzzer();
                    }
                }
            }

            // Count down
            if (state.timerMinutes === 0 && state.timerSeconds === 0 && state.timerTenths === 0) {
                // Timer reached 0
                clearInterval(f04TimerInterval);
                f04TimerInterval = null;
                state.timerRunning = false;
                document.getElementById('f04-timer-start-stop').classList.remove('toggled');
                playDoubleBuzzer();

                // Move to next program or round
                state.f04CurrentProgramIndex++;
                if (state.f04CurrentProgramIndex >= state.f04Programs.length) {
                    // All programs done, next round
                    state.f04CurrentRound++;
                    state.f04CurrentProgramIndex = 0;

                    if (state.f04CurrentRound > state.f04TotalRounds) {
                        // All rounds complete
                        state.f04MatchRunning = false;
                        state.f04CurrentRound = state.f04TotalRounds;
                    } else {
                        // Load first program of next round
                        const nextProg = state.f04Programs[0];
                        if (nextProg) {
                            state.timerMinutes = Math.floor(nextProg.time / 60);
                            state.timerSeconds = nextProg.time % 60;
                            state.timerTenths = 0;
                            state.f04FirstBellFired = false;
                        }
                    }
                } else {
                    // Load next program
                    const nextProg = state.f04Programs[state.f04CurrentProgramIndex];
                    if (nextProg) {
                        state.timerMinutes = Math.floor(nextProg.time / 60);
                        state.timerSeconds = nextProg.time % 60;
                        state.timerTenths = 0;
                        state.f04FirstBellFired = false;
                    }
                }
            } else {
                state.timerTenths--;
                if (state.timerTenths < 0) {
                    state.timerTenths = 9;
                    state.timerSeconds--;
                    if (state.timerSeconds < 0) {
                        state.timerSeconds = 59;
                        state.timerMinutes = Math.max(0, state.timerMinutes - 1);
                    }
                }
            }
            updateMonitor();
        }

        // F04 Rounds +1
        document.getElementById('f04-rounds-plus').addEventListener('click', () => {
            if (state.f04ProgrammingMode && state.f04ProgramStep === 'rounds') {
                state.f04TotalRounds = Math.min(99, state.f04TotalRounds + 1);
            } else if (!state.f04MatchRunning) {
                state.f04TotalRounds = Math.min(99, state.f04TotalRounds + 1);
            }
            updateMonitor();
        });

        // F04 Rounds -1
        document.getElementById('f04-rounds-minus').addEventListener('click', () => {
            if (state.f04ProgrammingMode && state.f04ProgramStep === 'rounds') {
                state.f04TotalRounds = Math.max(0, state.f04TotalRounds - 1);
            } else if (!state.f04MatchRunning) {
                state.f04TotalRounds = Math.max(0, state.f04TotalRounds - 1);
            }
            updateMonitor();
        });

        // F04 Rounds Reset (also handles programming mode transitions)
        document.getElementById('f04-rounds-reset').addEventListener('click', () => {
            if (state.f04MatchRunning) {
                // During match: reset current round timer
                if (state.f04Programs.length > 0) {
                    const currentProg = state.f04Programs[state.f04CurrentProgramIndex];
                    if (currentProg) {
                        state.timerMinutes = Math.floor(currentProg.time / 60);
                        state.timerSeconds = currentProg.time % 60;
                        state.timerTenths = 0;
                        state.f04FirstBellFired = false;
                    }
                }
            } else if (!state.f04ProgrammingMode) {
                // Not in programming mode yet - reset all
                state.f04Programs = [];
                state.f04TotalRounds = 0;
                state.f04CurrentRound = 1;
                state.f04CurrentProgramIndex = 0;
                state.f04DisplayProgram = 1;
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
            } else {
                // In programming mode - handle transitions
                const currentTimeSeconds = state.timerMinutes * 60 + state.timerSeconds;

                if (state.f04ProgramStep === 'time') {
                    if (currentTimeSeconds > 0) {
                        // Save time and switch to first bell input
                        if (state.f04Programs.length < state.f04DisplayProgram) {
                            state.f04Programs.push({ time: currentTimeSeconds, firstBell: 0 });
                        } else {
                            state.f04Programs[state.f04DisplayProgram - 1].time = currentTimeSeconds;
                        }
                        state.f04ProgramStep = 'firstbell';
                        state.timerMinutes = 0;
                        state.timerSeconds = 0;
                        state.timerTenths = 0;
                    } else {
                        // Time is 0 - go to rounds setting
                        state.f04ProgramStep = 'rounds';
                    }
                } else if (state.f04ProgramStep === 'firstbell') {
                    // Save first bell and move to next program
                    if (state.f04Programs[state.f04DisplayProgram - 1]) {
                        state.f04Programs[state.f04DisplayProgram - 1].firstBell = currentTimeSeconds;
                    }
                    state.f04DisplayProgram++;
                    state.f04ProgramStep = 'time';
                    state.timerMinutes = 0;
                    state.timerSeconds = 0;
                    state.timerTenths = 0;
                } else if (state.f04ProgramStep === 'rounds') {
                    // Confirm and exit programming mode
                    state.f04ProgrammingMode = false;
                    state.f04CurrentRound = 1;
                    state.f04CurrentProgramIndex = 0;

                    // Load first program
                    if (state.f04Programs.length > 0) {
                        const firstProg = state.f04Programs[0];
                        state.timerMinutes = Math.floor(firstProg.time / 60);
                        state.timerSeconds = firstProg.time % 60;
                        state.timerTenths = 0;
                        state.f04FirstBellFired = false;
                    }
                }
            }
            updateMonitor();
        });

        // F04 Timer Clear
        document.getElementById('f04-timer-clear').addEventListener('click', () => {
            state.timerMinutes = 0;
            state.timerSeconds = 0;
            state.timerTenths = 0;
            updateMonitor();
        });

        // F04 Timer Show Tenths
        document.getElementById('f04-timer-show-tenths').addEventListener('click', () => {
            state.showTenths = !state.showTenths;
            document.getElementById('f04-timer-show-tenths').classList.toggle('toggled', state.showTenths);
            updateMonitor();
        });

        // F04 Timer +1m
        document.getElementById('f04-timer-plus-1m').addEventListener('click', () => {
            if (!state.f04ProgrammingMode && state.f04Programs.length === 0) {
                // Enter programming mode
                state.f04ProgrammingMode = true;
                state.f04ProgramStep = 'time';
                state.f04DisplayProgram = 1;
            }
            state.timerMinutes = Math.min(99, state.timerMinutes + 1);
            updateMonitor();
        });

        // F04 Timer -1m
        document.getElementById('f04-timer-minus-1m').addEventListener('click', () => {
            state.timerMinutes = Math.max(0, state.timerMinutes - 1);
            updateMonitor();
        });

        // F04 Timer +1s
        document.getElementById('f04-timer-plus-1s').addEventListener('click', () => {
            if (!state.f04ProgrammingMode && state.f04Programs.length === 0) {
                // Enter programming mode
                state.f04ProgrammingMode = true;
                state.f04ProgramStep = 'time';
                state.f04DisplayProgram = 1;
            }
            state.timerSeconds++;
            if (state.timerSeconds >= 60) {
                state.timerSeconds = 0;
                state.timerMinutes = Math.min(99, state.timerMinutes + 1);
            }
            updateMonitor();
        });

        // F04 Timer -1s
        document.getElementById('f04-timer-minus-1s').addEventListener('click', () => {
            state.timerSeconds--;
            if (state.timerSeconds < 0) {
                state.timerSeconds = 59;
                state.timerMinutes = Math.max(0, state.timerMinutes - 1);
            }
            updateMonitor();
        });

        // F04 Timer Reset
        document.getElementById('f04-timer-reset').addEventListener('click', () => {
            if (state.f04MatchRunning) {
                // During match: reset back to programming mode
                if (f04TimerInterval) {
                    clearInterval(f04TimerInterval);
                    f04TimerInterval = null;
                }
                state.timerRunning = false;
                state.f04MatchRunning = false;
                state.f04ProgrammingMode = true;
                state.f04ProgramStep = 'time';
                state.f04DisplayProgram = 1;
                state.f04CurrentRound = 1;
                state.f04CurrentProgramIndex = 0;
                state.f04Programs = [];
                state.f04TotalRounds = 0;
                state.f04FirstBellFired = false;
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
                document.getElementById('f04-timer-start-stop').classList.remove('toggled');
            } else if (state.f04Programs.length > 0 && state.f04CurrentProgramIndex < state.f04Programs.length) {
                const currentProg = state.f04Programs[state.f04CurrentProgramIndex];
                state.timerMinutes = Math.floor(currentProg.time / 60);
                state.timerSeconds = currentProg.time % 60;
                state.timerTenths = 0;
                state.f04FirstBellFired = false;
            } else {
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
            }
            updateMonitor();
        });

        // F04 Timer Start/Stop
        document.getElementById('f04-timer-start-stop').addEventListener('click', () => {
            if (state.f04ProgrammingMode) {
                // Can't start during programming
                return;
            }

            if (state.timerRunning) {
                clearInterval(f04TimerInterval);
                f04TimerInterval = null;
                state.timerRunning = false;
            } else {
                if (state.f04Programs.length === 0) {
                    // No programs set
                    return;
                }
                state.timerRunning = true;
                state.f04MatchRunning = true;
                f04TimerInterval = setInterval(f04TimerTick, 100);
            }
            document.getElementById('f04-timer-start-stop').classList.toggle('toggled', state.timerRunning);
            updateMonitor();
        });

        // =====================
        // F05 Event Handlers (Wrestling)
        // =====================

        let f05TimerInterval = null;
        let f05WoundLeftInterval = null;
        let f05WoundRightInterval = null;

        function f05TimerTick() {
            if (state.timerMinutes === 0 && state.timerSeconds === 0 && state.timerTenths === 0) {
                // Timer reached 0 - move to next program
                clearInterval(f05TimerInterval);
                f05TimerInterval = null;
                state.timerRunning = false;
                document.getElementById('f05-timer-start-stop').classList.remove('toggled');
                playDoubleBuzzer();

                // Move to next program
                state.f05CurrentProgramIndex++;
                if (state.f05CurrentProgramIndex < state.f05Programs.length) {
                    const nextProg = state.f05Programs[state.f05CurrentProgramIndex];
                    state.timerMinutes = Math.floor(nextProg.time / 60);
                    state.timerSeconds = nextProg.time % 60;
                    state.timerTenths = 0;
                }
            } else {
                state.timerTenths--;
                if (state.timerTenths < 0) {
                    state.timerTenths = 9;
                    state.timerSeconds--;
                    if (state.timerSeconds < 0) {
                        state.timerSeconds = 59;
                        state.timerMinutes = Math.max(0, state.timerMinutes - 1);
                    }
                }
            }
            updateMonitor();
        }

        function f05WoundLeftTick() {
            state.f05WoundTimerLeft++;
            // Check for interval buzzer
            if (state.f05FirstBellInterval > 0 && state.f05WoundTimerLeft % state.f05FirstBellInterval === 0) {
                if (state.f05WoundTimerLeft < state.f05WoundTimerPreset) {
                    playBuzzer();
                }
            }
            // Check if reached preset
            if (state.f05WoundTimerLeft >= state.f05WoundTimerPreset) {
                clearInterval(f05WoundLeftInterval);
                f05WoundLeftInterval = null;
                state.f05WoundTimerLeftRunning = false;
                document.getElementById('f05-wound-left-start').classList.remove('toggled');
                playDoubleBuzzer();
            }
            updateMonitor();
        }

        function f05WoundRightTick() {
            state.f05WoundTimerRight++;
            // Check for interval buzzer
            if (state.f05FirstBellInterval > 0 && state.f05WoundTimerRight % state.f05FirstBellInterval === 0) {
                if (state.f05WoundTimerRight < state.f05WoundTimerPreset) {
                    playBuzzer();
                }
            }
            // Check if reached preset
            if (state.f05WoundTimerRight >= state.f05WoundTimerPreset) {
                clearInterval(f05WoundRightInterval);
                f05WoundRightInterval = null;
                state.f05WoundTimerRightRunning = false;
                document.getElementById('f05-wound-right-start').classList.remove('toggled');
                playDoubleBuzzer();
            }
            updateMonitor();
        }

        // F05 Win Count L+1
        document.getElementById('f05-win-left-plus').addEventListener('click', () => {
            if (state.f05WinCountLeft === null) {
                state.f05WinCountLeft = 0;
            } else if (state.f05WinCountLeft >= 9) {
                state.f05WinCountLeft = null;
            } else {
                state.f05WinCountLeft++;
            }
            updateMonitor();
        });

        // F05 Win Count R+1
        document.getElementById('f05-win-right-plus').addEventListener('click', () => {
            if (state.f05WinCountRight === null) {
                state.f05WinCountRight = 0;
            } else if (state.f05WinCountRight >= 9) {
                state.f05WinCountRight = null;
            } else {
                state.f05WinCountRight++;
            }
            updateMonitor();
        });

        // F05 Win Count L-1
        document.getElementById('f05-win-left-minus').addEventListener('click', () => {
            if (state.f05WinCountLeft === null) {
                state.f05WinCountLeft = 9;
            } else if (state.f05WinCountLeft <= 0) {
                state.f05WinCountLeft = null;
            } else {
                state.f05WinCountLeft--;
            }
            updateMonitor();
        });

        // F05 Win Count R-1
        document.getElementById('f05-win-right-minus').addEventListener('click', () => {
            if (state.f05WinCountRight === null) {
                state.f05WinCountRight = 9;
            } else if (state.f05WinCountRight <= 0) {
                state.f05WinCountRight = null;
            } else {
                state.f05WinCountRight--;
            }
            updateMonitor();
        });

        // F05 Wound Timer +1s (for programming mode)
        document.getElementById('f05-wound-plus-1s').addEventListener('click', () => {
            if (state.f05ProgrammingStep === 'wound') {
                state.f05WoundTimerPreset = Math.min(999, state.f05WoundTimerPreset + 1);
            } else if (state.f05ProgrammingStep === 'bell') {
                state.f05FirstBellInterval = Math.min(999, state.f05FirstBellInterval + 1);
            }
            updateMonitor();
        });

        // F05 Wound Timer -1s (for programming mode)
        document.getElementById('f05-wound-minus-1s').addEventListener('click', () => {
            if (state.f05ProgrammingStep === 'wound') {
                state.f05WoundTimerPreset = Math.max(1, state.f05WoundTimerPreset - 1);
            } else if (state.f05ProgrammingStep === 'bell') {
                state.f05FirstBellInterval = Math.max(1, state.f05FirstBellInterval - 1);
            }
            updateMonitor();
        });

        // F05 Wound Left Start/Stop
        document.getElementById('f05-wound-left-start').addEventListener('click', () => {
            if (state.f05ProgrammingMode) return;

            if (state.f05WoundTimerLeftRunning) {
                // Stop wound timer
                clearInterval(f05WoundLeftInterval);
                f05WoundLeftInterval = null;
                state.f05WoundTimerLeftRunning = false;
            } else {
                // Start wound timer - also stop main timer
                if (state.timerRunning) {
                    clearInterval(f05TimerInterval);
                    f05TimerInterval = null;
                    state.timerRunning = false;
                    document.getElementById('f05-timer-start-stop').classList.remove('toggled');
                }
                state.f05WoundTimerLeft = 0;
                state.f05WoundDisplayLeft = true;
                state.f05WoundTimerLeftRunning = true;
                f05WoundLeftInterval = setInterval(f05WoundLeftTick, 1000);
            }
            document.getElementById('f05-wound-left-start').classList.toggle('toggled', state.f05WoundTimerLeftRunning);
            updateMonitor();
        });

        // F05 Wound Right Start/Stop
        document.getElementById('f05-wound-right-start').addEventListener('click', () => {
            if (state.f05ProgrammingMode) return;

            if (state.f05WoundTimerRightRunning) {
                // Stop wound timer
                clearInterval(f05WoundRightInterval);
                f05WoundRightInterval = null;
                state.f05WoundTimerRightRunning = false;
            } else {
                // Start wound timer - also stop main timer
                if (state.timerRunning) {
                    clearInterval(f05TimerInterval);
                    f05TimerInterval = null;
                    state.timerRunning = false;
                    document.getElementById('f05-timer-start-stop').classList.remove('toggled');
                }
                state.f05WoundTimerRight = 0;
                state.f05WoundDisplayRight = true;
                state.f05WoundTimerRightRunning = true;
                f05WoundRightInterval = setInterval(f05WoundRightTick, 1000);
            }
            document.getElementById('f05-wound-right-start').classList.toggle('toggled', state.f05WoundTimerRightRunning);
            updateMonitor();
        });

        // F05 Wound Reset - return to score display
        document.getElementById('f05-wound-reset').addEventListener('click', () => {
            if (f05WoundLeftInterval) {
                clearInterval(f05WoundLeftInterval);
                f05WoundLeftInterval = null;
            }
            if (f05WoundRightInterval) {
                clearInterval(f05WoundRightInterval);
                f05WoundRightInterval = null;
            }
            state.f05WoundTimerLeftRunning = false;
            state.f05WoundTimerRightRunning = false;
            state.f05WoundDisplayLeft = false;
            state.f05WoundDisplayRight = false;
            state.f05WoundTimerLeft = 0;
            state.f05WoundTimerRight = 0;
            document.getElementById('f05-wound-left-start').classList.remove('toggled');
            document.getElementById('f05-wound-right-start').classList.remove('toggled');
            updateMonitor();
        });

        // F05 Timer Clear
        document.getElementById('f05-timer-clear').addEventListener('click', () => {
            state.timerMinutes = 0;
            state.timerSeconds = 0;
            state.timerTenths = 0;
            updateMonitor();
        });

        // F05 Timer Show Tenths
        document.getElementById('f05-timer-show-tenths').addEventListener('click', () => {
            state.showTenths = !state.showTenths;
            document.getElementById('f05-timer-show-tenths').classList.toggle('toggled', state.showTenths);
            updateMonitor();
        });

        // F05 Timer +1m
        document.getElementById('f05-timer-plus-1m').addEventListener('click', () => {
            if (!state.f05ProgrammingMode && state.f05Programs.length === 0) {
                state.f05ProgrammingMode = true;
                state.f05ProgrammingStep = 'time';
                state.f05DisplayProgram = 1;
            }
            state.timerMinutes = Math.min(99, state.timerMinutes + 1);
            updateMonitor();
        });

        // F05 Timer -1m
        document.getElementById('f05-timer-minus-1m').addEventListener('click', () => {
            state.timerMinutes = Math.max(0, state.timerMinutes - 1);
            updateMonitor();
        });

        // F05 Timer +1s
        document.getElementById('f05-timer-plus-1s').addEventListener('click', () => {
            if (!state.f05ProgrammingMode && state.f05Programs.length === 0) {
                state.f05ProgrammingMode = true;
                state.f05ProgrammingStep = 'time';
                state.f05DisplayProgram = 1;
            }
            state.timerSeconds++;
            if (state.timerSeconds >= 60) {
                state.timerSeconds = 0;
                state.timerMinutes = Math.min(99, state.timerMinutes + 1);
            }
            updateMonitor();
        });

        // F05 Timer -1s
        document.getElementById('f05-timer-minus-1s').addEventListener('click', () => {
            state.timerSeconds--;
            if (state.timerSeconds < 0) {
                state.timerSeconds = 59;
                state.timerMinutes = Math.max(0, state.timerMinutes - 1);
            }
            updateMonitor();
        });

        // F05 Timer Reset (handles programming workflow)
        document.getElementById('f05-timer-reset').addEventListener('click', () => {
            if (state.f05MatchRunning) {
                // During match - reset to programming mode
                if (f05TimerInterval) {
                    clearInterval(f05TimerInterval);
                    f05TimerInterval = null;
                }
                state.timerRunning = false;
                state.f05MatchRunning = false;
                state.f05ProgrammingMode = true;
                state.f05ProgrammingStep = 'time';
                state.f05DisplayProgram = 1;
                state.f05CurrentProgramIndex = 0;
                state.f05Programs = [];
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
                document.getElementById('f05-timer-start-stop').classList.remove('toggled');
            } else if (!state.f05ProgrammingMode) {
                // Not in programming mode - reset all
                state.f05Programs = [];
                state.f05CurrentProgramIndex = 0;
                state.f05DisplayProgram = 1;
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
            } else {
                // In programming mode
                const currentTimeSeconds = state.timerMinutes * 60 + state.timerSeconds;

                if (state.f05ProgrammingStep === 'time') {
                    if (currentTimeSeconds > 0) {
                        // Save time and move to next program
                        state.f05Programs.push({ time: currentTimeSeconds });
                        state.f05DisplayProgram++;
                        state.timerMinutes = 0;
                        state.timerSeconds = 0;
                        state.timerTenths = 0;
                    } else {
                        // Time is 0 - go to wound timer setting
                        state.f05ProgrammingStep = 'wound';
                    }
                } else if (state.f05ProgrammingStep === 'wound') {
                    // Move to bell interval setting
                    state.f05ProgrammingStep = 'bell';
                } else if (state.f05ProgrammingStep === 'bell') {
                    // Exit programming mode
                    state.f05ProgrammingMode = false;
                    state.f05CurrentProgramIndex = 0;

                    // Load first program
                    if (state.f05Programs.length > 0) {
                        const firstProg = state.f05Programs[0];
                        state.timerMinutes = Math.floor(firstProg.time / 60);
                        state.timerSeconds = firstProg.time % 60;
                        state.timerTenths = 0;
                    }
                }
            }
            updateMonitor();
        });

        // F05 Timer Start/Stop
        document.getElementById('f05-timer-start-stop').addEventListener('click', () => {
            if (state.f05ProgrammingMode) return;

            if (state.timerRunning) {
                clearInterval(f05TimerInterval);
                f05TimerInterval = null;
                state.timerRunning = false;
            } else {
                if (state.f05Programs.length === 0) return;
                state.timerRunning = true;
                state.f05MatchRunning = true;
                f05TimerInterval = setInterval(f05TimerTick, 100);
            }
            document.getElementById('f05-timer-start-stop').classList.toggle('toggled', state.timerRunning);
            updateMonitor();
        });

        // F05 Score L+1
        document.getElementById('f05-score-left-plus').addEventListener('click', () => {
            state.f05ScoreLeft = Math.min(999, state.f05ScoreLeft + 1);
            updateMonitor();
        });

        // F05 Score R+1
        document.getElementById('f05-score-right-plus').addEventListener('click', () => {
            state.f05ScoreRight = Math.min(999, state.f05ScoreRight + 1);
            updateMonitor();
        });

        // F05 Score L-1
        document.getElementById('f05-score-left-minus').addEventListener('click', () => {
            state.f05ScoreLeft = Math.max(0, state.f05ScoreLeft - 1);
            updateMonitor();
        });

        // F05 Score R-1
        document.getElementById('f05-score-right-minus').addEventListener('click', () => {
            state.f05ScoreRight = Math.max(0, state.f05ScoreRight - 1);
            updateMonitor();
        });

        // F05 Score Reset
        document.getElementById('f05-score-reset').addEventListener('click', () => {
            state.f05ScoreLeft = 0;
            state.f05ScoreRight = 0;
            updateMonitor();
        });

        // =====================
        // F06 Event Handlers (Program Timer / Repeat)
        // =====================

        let f06TimerInterval = null;

        function f06TimerTick() {
            if (state.timerMinutes === 0 && state.timerSeconds === 0 && state.timerTenths === 0) {
                // Timer reached 0
                playBuzzer();

                // Move to next program
                state.f06CurrentProgramIndex++;
                if (state.f06CurrentProgramIndex >= state.f06Programs.length) {
                    // All programs done - check repeat
                    if (state.f06RepeatCount === 0) {
                        // Endless repeat - start over
                        state.f06CurrentProgramIndex = 0;
                        const firstProg = state.f06Programs[0];
                        state.timerMinutes = Math.floor(firstProg.time / 60);
                        state.timerSeconds = firstProg.time % 60;
                        state.timerTenths = 0;
                    } else {
                        state.f06CurrentRepeat++;
                        if (state.f06CurrentRepeat > state.f06RepeatCount) {
                            // All repeats complete - stop timer
                            clearInterval(f06TimerInterval);
                            f06TimerInterval = null;
                            state.timerRunning = false;
                            state.f06MatchRunning = false;
                            state.f06CurrentRepeat = state.f06RepeatCount;
                            state.f06CurrentProgramIndex = state.f06Programs.length - 1;
                            document.getElementById('f06-timer-start-stop').classList.remove('toggled');
                            playDoubleBuzzer();
                        } else {
                            // Start next repeat
                            state.f06CurrentProgramIndex = 0;
                            const firstProg = state.f06Programs[0];
                            state.timerMinutes = Math.floor(firstProg.time / 60);
                            state.timerSeconds = firstProg.time % 60;
                            state.timerTenths = 0;
                        }
                    }
                } else {
                    // Load next program (timer keeps running)
                    const nextProg = state.f06Programs[state.f06CurrentProgramIndex];
                    state.timerMinutes = Math.floor(nextProg.time / 60);
                    state.timerSeconds = nextProg.time % 60;
                    state.timerTenths = 0;
                }
            } else {
                state.timerTenths--;
                if (state.timerTenths < 0) {
                    state.timerTenths = 9;
                    state.timerSeconds--;
                    if (state.timerSeconds < 0) {
                        state.timerSeconds = 59;
                        state.timerMinutes = Math.max(0, state.timerMinutes - 1);
                    }
                }
            }
            updateMonitor();
        }

        // F06 Repeat +1
        document.getElementById('f06-repeat-plus').addEventListener('click', () => {
            state.f06RepeatCount = Math.min(99, state.f06RepeatCount + 1);
            updateMonitor();
        });

        // F06 Repeat -1
        document.getElementById('f06-repeat-minus').addEventListener('click', () => {
            state.f06RepeatCount = Math.max(0, state.f06RepeatCount - 1);
            updateMonitor();
        });

        // F06 Timer Clear
        document.getElementById('f06-timer-clear').addEventListener('click', () => {
            state.timerMinutes = 0;
            state.timerSeconds = 0;
            state.timerTenths = 0;
            updateMonitor();
        });

        // F06 Timer Show Tenths
        document.getElementById('f06-timer-show-tenths').addEventListener('click', () => {
            state.showTenths = !state.showTenths;
            document.getElementById('f06-timer-show-tenths').classList.toggle('toggled', state.showTenths);
            updateMonitor();
        });

        // F06 Timer +1m
        document.getElementById('f06-timer-plus-1m').addEventListener('click', () => {
            if (!state.f06ProgrammingMode && state.f06Programs.length === 0) {
                state.f06ProgrammingMode = true;
                state.f06DisplayProgram = 1;
            }
            state.timerMinutes = Math.min(99, state.timerMinutes + 1);
            updateMonitor();
        });

        // F06 Timer -1m
        document.getElementById('f06-timer-minus-1m').addEventListener('click', () => {
            state.timerMinutes = Math.max(0, state.timerMinutes - 1);
            updateMonitor();
        });

        // F06 Timer +1s
        document.getElementById('f06-timer-plus-1s').addEventListener('click', () => {
            if (!state.f06ProgrammingMode && state.f06Programs.length === 0) {
                state.f06ProgrammingMode = true;
                state.f06DisplayProgram = 1;
            }
            state.timerSeconds++;
            if (state.timerSeconds >= 60) {
                state.timerSeconds = 0;
                state.timerMinutes = Math.min(99, state.timerMinutes + 1);
            }
            updateMonitor();
        });

        // F06 Timer -1s
        document.getElementById('f06-timer-minus-1s').addEventListener('click', () => {
            state.timerSeconds--;
            if (state.timerSeconds < 0) {
                state.timerSeconds = 59;
                state.timerMinutes = Math.max(0, state.timerMinutes - 1);
            }
            updateMonitor();
        });

        // F06 Timer Reset (handles programming workflow)
        document.getElementById('f06-timer-reset').addEventListener('click', () => {
            if (state.f06MatchRunning) {
                // During match - reset to programming mode
                if (f06TimerInterval) {
                    clearInterval(f06TimerInterval);
                    f06TimerInterval = null;
                }
                state.timerRunning = false;
                state.f06MatchRunning = false;
                state.f06ProgrammingMode = true;
                state.f06DisplayProgram = 1;
                state.f06CurrentProgramIndex = 0;
                state.f06CurrentRepeat = 1;
                state.f06Programs = [];
                state.f06RepeatCount = 0;
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
                document.getElementById('f06-timer-start-stop').classList.remove('toggled');
            } else if (!state.f06ProgrammingMode) {
                // Not in programming mode - reset all
                state.f06Programs = [];
                state.f06CurrentProgramIndex = 0;
                state.f06CurrentRepeat = 1;
                state.f06DisplayProgram = 1;
                state.f06RepeatCount = 0;
                state.timerMinutes = 0;
                state.timerSeconds = 0;
                state.timerTenths = 0;
            } else {
                // In programming mode
                const currentTimeSeconds = state.timerMinutes * 60 + state.timerSeconds;

                if (currentTimeSeconds > 0) {
                    // Save time and move to next program
                    state.f06Programs.push({ time: currentTimeSeconds });
                    state.f06DisplayProgram++;
                    state.timerMinutes = 0;
                    state.timerSeconds = 0;
                    state.timerTenths = 0;
                } else {
                    // Time is 0 - exit programming mode (ready to set repeat count)
                    state.f06ProgrammingMode = false;
                    state.f06CurrentProgramIndex = 0;
                    state.f06CurrentRepeat = 1;

                    // Load first program
                    if (state.f06Programs.length > 0) {
                        const firstProg = state.f06Programs[0];
                        state.timerMinutes = Math.floor(firstProg.time / 60);
                        state.timerSeconds = firstProg.time % 60;
                        state.timerTenths = 0;
                    }
                }
            }
            updateMonitor();
        });

        // F06 Timer Start/Stop
        document.getElementById('f06-timer-start-stop').addEventListener('click', () => {
            if (state.f06ProgrammingMode) return;

            if (state.timerRunning) {
                clearInterval(f06TimerInterval);
                f06TimerInterval = null;
                state.timerRunning = false;
            } else {
                if (state.f06Programs.length === 0) return;
                state.timerRunning = true;
                state.f06MatchRunning = true;
                state.f06CurrentRepeat = 1;
                f06TimerInterval = setInterval(f06TimerTick, 100);
            }
            document.getElementById('f06-timer-start-stop').classList.toggle('toggled', state.timerRunning);
            updateMonitor();
        });

        // =====================
        // F07 Event Handlers (Shuttle Run)
        // =====================

        // Shuttle run level table (from shuttlerun.md)
        const f07LevelTable = [
            { level: 1, totalCount: 7, levelCount: 7, bpm: 60, timeLimit: 9 },
            { level: 2, totalCount: 15, levelCount: 8, bpm: 67.5, timeLimit: 8 },
            { level: 3, totalCount: 23, levelCount: 8, bpm: 71.25, timeLimit: 7.58 },
            { level: 4, totalCount: 32, levelCount: 9, bpm: 75, timeLimit: 7.2 },
            { level: 5, totalCount: 41, levelCount: 9, bpm: 78.75, timeLimit: 6.86 },
            { level: 6, totalCount: 51, levelCount: 10, bpm: 82.5, timeLimit: 6.55 },
            { level: 7, totalCount: 61, levelCount: 10, bpm: 86.25, timeLimit: 6.26 },
            { level: 8, totalCount: 72, levelCount: 11, bpm: 90, timeLimit: 6 },
            { level: 9, totalCount: 83, levelCount: 11, bpm: 93.75, timeLimit: 5.76 },
            { level: 10, totalCount: 94, levelCount: 11, bpm: 97.5, timeLimit: 5.54 },
            { level: 11, totalCount: 106, levelCount: 12, bpm: 101.25, timeLimit: 5.33 },
            { level: 12, totalCount: 118, levelCount: 12, bpm: 105, timeLimit: 5.14 },
            { level: 13, totalCount: 131, levelCount: 13, bpm: 108.75, timeLimit: 4.97 },
            { level: 14, totalCount: 144, levelCount: 13, bpm: 112.5, timeLimit: 4.8 },
            { level: 15, totalCount: 157, levelCount: 13, bpm: 116.25, timeLimit: 4.65 },
            { level: 16, totalCount: 171, levelCount: 14, bpm: 120, timeLimit: 4.5 },
            { level: 17, totalCount: 185, levelCount: 14, bpm: 123.75, timeLimit: 4.36 },
            { level: 18, totalCount: 200, levelCount: 15, bpm: 127.5, timeLimit: 4.24 },
            { level: 19, totalCount: 215, levelCount: 15, bpm: 131.25, timeLimit: 4.11 },
            { level: 20, totalCount: 231, levelCount: 16, bpm: 135, timeLimit: 4 },
            { level: 21, totalCount: 247, levelCount: 16, bpm: 138.75, timeLimit: 3.89 },
            { level: 22, totalCount: 263, levelCount: 16, bpm: 142.5, timeLimit: 3.79 },
            { level: 23, totalCount: 280, levelCount: 17, bpm: 146.25, timeLimit: 3.69 },
            { level: 24, totalCount: 297, levelCount: 17, bpm: 150, timeLimit: 3.6 },
            { level: 25, totalCount: 315, levelCount: 18, bpm: 153.75, timeLimit: 3.51 },
            { level: 26, totalCount: 333, levelCount: 18, bpm: 157.5, timeLimit: 3.43 },
            { level: 27, totalCount: 351, levelCount: 18, bpm: 161.25, timeLimit: 3.35 },
            { level: 28, totalCount: 370, levelCount: 19, bpm: 165, timeLimit: 3.27 },
            { level: 29, totalCount: 389, levelCount: 19, bpm: 168.75, timeLimit: 3.2 },
            { level: 30, totalCount: 409, levelCount: 20, bpm: 172.5, timeLimit: 3.13 },
            { level: 31, totalCount: 429, levelCount: 20, bpm: 176.25, timeLimit: 3.06 },
            { level: 32, totalCount: 450, levelCount: 21, bpm: 180, timeLimit: 3 },
            { level: 33, totalCount: 471, levelCount: 21, bpm: 183.75, timeLimit: 2.94 },
            { level: 34, totalCount: 492, levelCount: 21, bpm: 187.5, timeLimit: 2.88 },
            { level: 35, totalCount: 514, levelCount: 22, bpm: 191.25, timeLimit: 2.82 },
            { level: 36, totalCount: 536, levelCount: 22, bpm: 195, timeLimit: 2.77 },
            { level: 37, totalCount: 559, levelCount: 23, bpm: 198.75, timeLimit: 2.72 },
            { level: 38, totalCount: 582, levelCount: 23, bpm: 202.5, timeLimit: 2.67 },
            { level: 39, totalCount: 605, levelCount: 23, bpm: 206.25, timeLimit: 2.62 },
            { level: 40, totalCount: 629, levelCount: 24, bpm: 210, timeLimit: 2.57 }
        ];

        // Score tables
        const f07MaleScoreTable = [
            { score: 10, minCount: 125 },
            { score: 9, minCount: 113 },
            { score: 8, minCount: 102 },
            { score: 7, minCount: 90 },
            { score: 6, minCount: 76 },
            { score: 5, minCount: 63 },
            { score: 4, minCount: 51 },
            { score: 3, minCount: 37 },
            { score: 2, minCount: 26 },
            { score: 1, minCount: 0 }
        ];

        const f07FemaleScoreTable = [
            { score: 10, minCount: 88 },
            { score: 9, minCount: 76 },
            { score: 8, minCount: 64 },
            { score: 7, minCount: 54 },
            { score: 6, minCount: 44 },
            { score: 5, minCount: 35 },
            { score: 4, minCount: 27 },
            { score: 3, minCount: 21 },
            { score: 2, minCount: 15 },
            { score: 1, minCount: 0 }
        ];

        // Note sequence for going right: C->D->E->F->G->A->B->CH->CL (turnaround)
        // Note sequence for going left: CH->B->A->G->F->E->D->C->CL (turnaround)
        const f07NotesRight = ['C', 'D', 'E', 'F', 'G', 'A', 'B', 'CH', 'CL'];
        const f07NotesLeft = ['CH', 'B', 'A', 'G', 'F', 'E', 'D', 'C', 'CL'];

        let f07Interval = null;
        let f07CountdownInterval = null;
        let f07NoteIntervalMs = 60000 / 60 / 9; // Default: 60 BPM, 9 notes per shuttle

        function f07GetMaleScore(count) {
            for (let i = 0; i < f07MaleScoreTable.length; i++) {
                if (count >= f07MaleScoreTable[i].minCount) {
                    return f07MaleScoreTable[i].score === 10 ? 11 : f07MaleScoreTable[i].score;
                }
            }
            return 1;
        }

        function f07GetFemaleScore(count) {
            for (let i = 0; i < f07FemaleScoreTable.length; i++) {
                if (count >= f07FemaleScoreTable[i].minCount) {
                    return f07FemaleScoreTable[i].score === 10 ? 11 : f07FemaleScoreTable[i].score;
                }
            }
            return 1;
        }

        function f07GetLevelInfo(level) {
            return f07LevelTable.find(l => l.level === level) || f07LevelTable[0];
        }

        function f07UpdateScores() {
            state.f07ScoreMale = f07GetMaleScore(state.f07ShuttleCount);
            state.f07ScoreFemale = f07GetFemaleScore(state.f07ShuttleCount);
        }

        function f07PlayNextNote() {
            const notes = state.f07GoingRight ? f07NotesRight : f07NotesLeft;
            const note = notes[state.f07NotePosition];

            // Check if this is level up (CL position but level changing)
            if (state.f07NotePosition === 8) {
                // End of shuttle - check level
                state.f07ShuttleCount++;
                state.f07LevelShuttleCount++;

                const levelInfo = f07GetLevelInfo(state.f07Level);
                if (state.f07ShuttleCount >= levelInfo.totalCount && state.f07Level < 40) {
                    // Level up! Play buzzer instead of CL
                    playBuzzer();
                    state.f07Level++;
                    state.f07LevelShuttleCount = 0;
                    const newLevelInfo = f07GetLevelInfo(state.f07Level);
                    state.f07ShuttleTime = newLevelInfo.timeLimit;
                    f07NoteIntervalMs = (state.f07ShuttleTime * 1000) / 9;
                } else {
                    // Normal turnaround
                    playShuttleNote('CL');
                }

                // Switch direction
                state.f07GoingRight = !state.f07GoingRight;
                state.f07NotePosition = 0;
                state.f07DotCount = 0;
                f07UpdateScores();
            } else {
                // Play the note
                playShuttleNote(note);
                state.f07NotePosition++;
                state.f07DotCount = state.f07NotePosition;
            }

            // Reset shuttle time display for countdown
            const levelInfo = f07GetLevelInfo(state.f07Level);
            state.f07ShuttleTime = levelInfo.timeLimit;

            updateMonitor();

            // Schedule next note
            f07Interval = setTimeout(f07PlayNextNote, f07NoteIntervalMs);
        }

        function f07CountdownTick() {
            state.f07CountdownTenths--;
            if (state.f07CountdownTenths < 0) {
                state.f07CountdownTenths = 9;
                state.f07Countdown--;

                // Beep every second in last 5 seconds
                if (state.f07Countdown >= 0 && state.f07Countdown < 5) {
                    playBuzzer();
                }

                if (state.f07Countdown < 0) {
                    // Countdown finished - start shuttle run
                    clearInterval(f07CountdownInterval);
                    f07CountdownInterval = null;
                    state.f07CountdownPhase = false;
                    state.f07Countdown = 0;

                    // Start with the first note
                    state.f07GoingRight = state.f07Direction === 'right';
                    state.f07NotePosition = 0;
                    state.f07DotCount = 0;
                    state.f07ShuttleCount = 0;
                    state.f07LevelShuttleCount = 0;
                    state.f07Level = 1;
                    const levelInfo = f07GetLevelInfo(1);
                    state.f07ShuttleTime = levelInfo.timeLimit;
                    f07NoteIntervalMs = (state.f07ShuttleTime * 1000) / 9;

                    // Play buzzer to start
                    playBuzzer();

                    // Start the note sequence
                    f07Interval = setTimeout(f07PlayNextNote, f07NoteIntervalMs);
                }
            }
            updateMonitor();
        }

        // F07 +1m
        document.getElementById('f07-plus-1m').addEventListener('click', () => {
            if (state.f07CountdownPhase && !state.f07Running) {
                state.f07Countdown = Math.min(600, state.f07Countdown + 60);
            }
            updateMonitor();
        });

        // F07 -1m
        document.getElementById('f07-minus-1m').addEventListener('click', () => {
            if (state.f07CountdownPhase && !state.f07Running) {
                state.f07Countdown = Math.max(0, state.f07Countdown - 60);
            }
            updateMonitor();
        });

        // F07 +1s
        document.getElementById('f07-plus-1s').addEventListener('click', () => {
            if (state.f07CountdownPhase && !state.f07Running) {
                state.f07Countdown = Math.min(600, state.f07Countdown + 1);
            }
            updateMonitor();
        });

        // F07 -1s
        document.getElementById('f07-minus-1s').addEventListener('click', () => {
            if (state.f07CountdownPhase && !state.f07Running) {
                state.f07Countdown = Math.max(0, state.f07Countdown - 1);
            }
            updateMonitor();
        });

        // F07 +1step (advance one note)
        document.getElementById('f07-plus-1step').addEventListener('click', () => {
            if (state.f07Running && !state.f07CountdownPhase) {
                // Manual advance - play next note immediately
                clearTimeout(f07Interval);
                f07PlayNextNote();
            }
            updateMonitor();
        });

        // F07 Direction left
        document.getElementById('f07-dir-left').addEventListener('click', () => {
            if (state.f07CountdownPhase && !state.f07Running) {
                state.f07Direction = 'left';
            }
            updateMonitor();
        });

        // F07 Direction right
        document.getElementById('f07-dir-right').addEventListener('click', () => {
            if (state.f07CountdownPhase && !state.f07Running) {
                state.f07Direction = 'right';
            }
            updateMonitor();
        });

        // F07 Reset
        document.getElementById('f07-reset').addEventListener('click', () => {
            if (f07CountdownInterval) {
                clearInterval(f07CountdownInterval);
                f07CountdownInterval = null;
            }
            if (f07Interval) {
                clearTimeout(f07Interval);
                f07Interval = null;
            }
            state.f07Running = false;
            state.f07CountdownPhase = true;
            state.f07Countdown = 5;
            state.f07CountdownTenths = 0;
            state.f07Direction = 'right';
            state.f07Level = 1;
            state.f07ShuttleCount = 0;
            state.f07LevelShuttleCount = 0;
            state.f07NotePosition = 0;
            state.f07ShuttleTime = 9.0;
            state.f07ScoreMale = 1;
            state.f07ScoreFemale = 1;
            state.f07GoingRight = true;
            state.f07DotCount = 0;
            document.getElementById('f07-start-stop').classList.remove('toggled');
            updateMonitor();
        });

        // F07 Start/Stop
        document.getElementById('f07-start-stop').addEventListener('click', () => {
            if (state.f07Running) {
                // Stop
                if (f07CountdownInterval) {
                    clearInterval(f07CountdownInterval);
                    f07CountdownInterval = null;
                }
                if (f07Interval) {
                    clearTimeout(f07Interval);
                    f07Interval = null;
                }
                state.f07Running = false;
            } else {
                // Start
                state.f07Running = true;
                if (state.f07CountdownPhase) {
                    // Start countdown
                    state.f07CountdownTenths = 0;
                    f07CountdownInterval = setInterval(f07CountdownTick, 100);
                } else {
                    // Resume note playing
                    const levelInfo = f07GetLevelInfo(state.f07Level);
                    f07NoteIntervalMs = (levelInfo.timeLimit * 1000) / 9;
                    f07Interval = setTimeout(f07PlayNextNote, f07NoteIntervalMs);
                }
            }
            document.getElementById('f07-start-stop').classList.toggle('toggled', state.f07Running);
            updateMonitor();
        });

        updateMonitor();
    </script>
</body>

</html>