<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Timer Display</title>
    <style>
        @font-face {
            font-family: 'DSEG7 Classic';
            src: url('./fonts/DSEG7Classic-Bold.woff2') format('woff2');
            font-weight: bold;
            font-style: normal;
        }

        @font-face {
            font-family: 'LED Calculator';
            src: url('./fonts/LEDCalculator.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .display-container {
            transform: scale(1.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .row-top {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .arrow {
            font-family: 'LED Calculator', sans-serif;
            font-size: 48px;
            color: #222;
        }

        .arrow.active {
            color: #d00;
        }

        .timer-main {
            font-family: 'DSEG7 Classic', sans-serif;
            font-size: 80px;
            color: #fff;
            letter-spacing: 4px;
            position: relative;
        }

        .timer-placeholder {
            color: rgba(255, 255, 255, 0.08);
        }

        .timer-value {
            position: absolute;
            top: 0;
            right: 0;
        }

        .timer-value.left-align {
            right: auto;
            left: 0;
        }

        .row-middle {
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'LED Calculator', sans-serif;
            font-size: 24px;
            color: #0d0;
        }

        .label-hg {
            min-width: 20px;
            text-align: center;
            color: #030;
        }

        .label-hg.active {
            color: #0d0;
        }

        .dot {
            color: #030;
        }

        .dot.active {
            color: #0d0;
        }

        .row-bottom {
            display: flex;
            align-items: baseline;
            gap: 50px;
        }

        .score-container {
            position: relative;
            font-family: 'DSEG7 Classic', sans-serif;
            font-size: 60px;
            text-align: right;
            min-width: 120px;
        }

        .score-placeholder {
            color: rgba(255, 165, 0, 0.1);
        }

        .score-value {
            position: absolute;
            top: 0;
            right: 0;
            color: orange;
        }

        .shot-clock-container {
            position: relative;
            font-family: 'DSEG7 Classic', sans-serif;
            font-size: 60px;
            text-align: right;
            min-width: 80px;
        }

        .shot-clock-placeholder {
            color: rgba(221, 0, 0, 0.1);
        }

        .shot-clock-value {
            position: absolute;
            top: 0;
            right: 0;
            color: #d00;
        }
    </style>
</head>

<body>
    <div class="display-container">
        <div class="row-top">
            <span id="arrow-left" class="arrow">&lt;</span>
            <div class="timer-main">
                <span class="timer-placeholder">88:88</span>
                <span id="timer-display" class="timer-value">10:00</span>
            </div>
            <span id="arrow-right" class="arrow">&gt;</span>
        </div>

        <div class="row-middle">
            <span id="label-left" class="label-hg">H</span>
            <span id="dot-1" class="dot">.</span>
            <span id="dot-2" class="dot">.</span>
            <span id="dot-3" class="dot">.</span>
            <span id="dot-4" class="dot">.</span>
            <span id="dot-5" class="dot">.</span>
            <span id="dot-6" class="dot">.</span>
            <span id="dot-7" class="dot">.</span>
            <span id="label-right" class="label-hg">G</span>
        </div>

        <div class="row-bottom">
            <div class="score-container">
                <span class="score-placeholder">888</span>
                <span id="score-home" class="score-value">0</span>
            </div>
            <div class="shot-clock-container">
                <span class="shot-clock-placeholder">88</span>
                <span id="shot-clock" class="shot-clock-value">24</span>
            </div>
            <div class="score-container">
                <span class="score-placeholder">888</span>
                <span id="score-guest" class="score-value">0</span>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // Firebase設定
        const firebaseConfig = {
            databaseURL: "https://molten-timer-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const stateRef = database.ref('timer-state');

        let state = {
            functionMode: 'F01',
            timerMinutes: 10,
            timerSeconds: 0,
            timerTenths: 0,
            timerRunning: false,
            showTenths: false,
            shotClock: 24,
            shotClockTenths: 0,
            shotClockBlank: false,
            shotClockRunning: false,
            scoreHome: 0,
            scoreGuest: 0,
            scoreHomeBlank: false,
            scoreGuestBlank: false,
            period: null,
            arrowLeft: false,
            arrowRight: false,
            courtFlipped: false,
            hgState: 0,
            programMode: false,
            programNumber: 1,
            // F02 specific
            gameSetsLeft: 0,
            gameSetsRight: 0,
            timeoutTimer: 30,
            timeoutTimerTenths: 0,
            timeoutTimerRunning: false,
            timeoutTimerBlank: true,
            timeoutTimerPreset: 30,
            // F03 specific (Judo)
            osaekomiTimer: 0,
            osaekomiTimerRunning: false,
            osaekomiTimerBlank: true,
            osaekomiIpponTime: 25,
            osaekomiWazaTime: 20,
            wazaAriActive: false,
            // F04 specific (Boxing)
            f04Programs: [],
            f04TotalRounds: 0,
            f04CurrentRound: 1,
            f04CurrentProgramIndex: 0,
            f04ProgrammingMode: false,
            f04ProgramStep: 'time',
            f04DisplayProgram: 1,
            f04FirstBellFired: false,
            f04MatchRunning: false,
            // F05 specific (Wrestling)
            f05Programs: [],
            f05WoundTimerPreset: 120,
            f05FirstBellInterval: 30,
            f05CurrentProgramIndex: 0,
            f05ProgrammingMode: false,
            f05ProgrammingStep: 'time',
            f05DisplayProgram: 1,
            f05ScoreLeft: 0,
            f05ScoreRight: 0,
            f05WinCountLeft: null,
            f05WinCountRight: null,
            f05WoundTimerLeft: 0,
            f05WoundTimerRight: 0,
            f05WoundTimerLeftRunning: false,
            f05WoundTimerRightRunning: false,
            f05WoundDisplayLeft: false,
            f05WoundDisplayRight: false,
            f05MatchRunning: false,
            f05LastBellLeft: 0,
            f05LastBellRight: 0,
            // F06 specific (Program Timer / Repeat)
            f06Programs: [],
            f06RepeatCount: 0,
            f06CurrentRepeat: 1,
            f06CurrentProgramIndex: 0,
            f06ProgrammingMode: false,
            f06DisplayProgram: 1,
            f06MatchRunning: false,
            // F07 specific (Shuttle Run)
            f07Countdown: 5,
            f07CountdownTenths: 0,
            f07Direction: 'right',
            f07Running: false,
            f07Level: 1,
            f07ShuttleCount: 0,
            f07LevelShuttleCount: 0,
            f07NotePosition: 0,
            f07ShuttleTime: 9.0,
            f07ShuttleTimeTenths: 0,
            f07ScoreMale: 1,
            f07ScoreFemale: 1,
            f07GoingRight: true,
            f07CountdownPhase: true,
            f07DotCount: 0,
            f07CurrentTime: 0.0
        };

        const timerDisplayEl = document.getElementById('timer-display');
        const arrowLeftEl = document.getElementById('arrow-left');
        const arrowRightEl = document.getElementById('arrow-right');
        const scoreHomeEl = document.getElementById('score-home');
        const scoreGuestEl = document.getElementById('score-guest');
        const shotClockEl = document.getElementById('shot-clock');
        const labelLeftEl = document.getElementById('label-left');
        const labelRightEl = document.getElementById('label-right');
        const dots = [
            document.getElementById('dot-1'),
            document.getElementById('dot-2'),
            document.getElementById('dot-3'),
            document.getElementById('dot-4'),
            document.getElementById('dot-5'),
            document.getElementById('dot-6'),
            document.getElementById('dot-7')
        ];

        // Firebase リアルタイム同期（BroadcastChannelの代わり）
        stateRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                state = { ...state, ...data };
                updateDisplay();
            }
        });

        // BroadcastChannel も維持（同一デバイス内での同期用）
        const channel = new BroadcastChannel('basketball-timer');
        channel.onmessage = (event) => {
            state = { ...state, ...event.data };
            updateDisplay();
        };

        function updateDisplay() {
            if (state.functionMode === 'F02') {
                // F02 Mode: Volleyball, Badminton, Table Tennis
                // Top row: Serve indicator + Score (2 digits each)
                const leftScore = state.courtFlipped ? state.scoreGuest : state.scoreHome;
                const rightScore = state.courtFlipped ? state.scoreHome : state.scoreGuest;
                const leftStr = leftScore < 10 ? `!${leftScore}` : `${leftScore}`;
                const rightStr = rightScore < 10 ? `!${rightScore}` : `${rightScore}`;
                timerDisplayEl.textContent = `${leftStr} ${rightStr}`;
                timerDisplayEl.classList.remove('left-align');

                arrowLeftEl.classList.toggle('active', state.arrowLeft);
                arrowRightEl.classList.toggle('active', state.arrowRight);

                // Middle row: Only period dots (H/G labels hidden)
                labelLeftEl.textContent = '';
                labelRightEl.textContent = '';
                labelLeftEl.classList.remove('active');
                labelRightEl.classList.remove('active');

                const periodMap = { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 'E': 6 };
                const activeDots = periodMap[state.period] || 0;
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index < activeDots);
                });

                // Bottom row: Game Sets (left) / Timeout Timer (center) / Game Sets (right)
                const gameSetsL = state.courtFlipped ? state.gameSetsRight : state.gameSetsLeft;
                const gameSetsR = state.courtFlipped ? state.gameSetsLeft : state.gameSetsRight;
                scoreHomeEl.textContent = gameSetsL;
                scoreGuestEl.textContent = gameSetsR;

                // Timeout Timer in center (replaces shot clock)
                if (state.timeoutTimerBlank) {
                    shotClockEl.textContent = '';
                } else {
                    shotClockEl.textContent = state.timeoutTimer;
                }
            } else if (state.functionMode === 'F03') {
                // F03 Mode: Judo
                // Top row: Match time (same as F01 timer)
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;

                const isTenthsMode = state.showTenths && mins === 0 && secs < 60;
                timerDisplayEl.classList.toggle('left-align', isTenthsMode);

                if (isTenthsMode) {
                    const secsStr = secs < 10 ? `!${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${secsStr}. ${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${mStr}:${sStr}`;
                }

                // Hide arrows for F03
                arrowLeftEl.classList.remove('active');
                arrowRightEl.classList.remove('active');

                // Middle row: Hide H/G labels and dots
                labelLeftEl.textContent = '';
                labelRightEl.textContent = '';
                labelLeftEl.classList.remove('active');
                labelRightEl.classList.remove('active');
                dots.forEach((dot) => {
                    dot.classList.remove('active');
                });

                // Bottom row: Hide scores, show osaekomi timer in center
                scoreHomeEl.textContent = '';
                scoreGuestEl.textContent = '';

                // Osaekomi timer in center
                if (state.osaekomiTimerBlank) {
                    shotClockEl.textContent = '';
                } else {
                    shotClockEl.textContent = state.osaekomiTimer;
                }
            } else if (state.functionMode === 'F04') {
                // F04 Mode: Boxing
                // Top row: Match time (same as F01 timer)
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;

                const isTenthsMode = state.showTenths && mins === 0 && secs < 60;
                timerDisplayEl.classList.toggle('left-align', isTenthsMode);

                if (isTenthsMode) {
                    const secsStr = secs < 10 ? `!${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${secsStr}. ${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${mStr}:${sStr}`;
                }

                // Hide arrows for F04
                arrowLeftEl.classList.remove('active');
                arrowRightEl.classList.remove('active');

                // Middle row: Hide H/G labels and dots
                labelLeftEl.textContent = '';
                labelRightEl.textContent = '';
                labelLeftEl.classList.remove('active');
                labelRightEl.classList.remove('active');
                dots.forEach((dot) => {
                    dot.classList.remove('active');
                });

                // Bottom row: Round number (left) / Program number (right) during programming
                if (state.f04ProgrammingMode) {
                    scoreHomeEl.textContent = state.f04TotalRounds;
                    if (state.f04ProgramStep === 'time') {
                        scoreGuestEl.textContent = `P${String(state.f04DisplayProgram).padStart(2, '0')}`;
                    } else {
                        scoreGuestEl.textContent = `F${String(state.f04DisplayProgram).padStart(2, '0')}`;
                    }
                    shotClockEl.textContent = '';
                } else if (state.f04MatchRunning || state.f04TotalRounds > 0) {
                    scoreHomeEl.textContent = state.f04CurrentRound;
                    scoreGuestEl.textContent = '';
                    shotClockEl.textContent = '';
                } else {
                    scoreHomeEl.textContent = '0';
                    scoreGuestEl.textContent = 'P01';
                    shotClockEl.textContent = '';
                }
            } else if (state.functionMode === 'F05') {
                // F05 Mode: Wrestling
                // Top row: Match time
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;

                const isTenthsMode = state.showTenths && mins === 0 && secs < 60;
                timerDisplayEl.classList.toggle('left-align', isTenthsMode);

                if (isTenthsMode) {
                    const secsStr = secs < 10 ? `!${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${secsStr}. ${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${mStr}:${sStr}`;
                }

                // Hide arrows for F05
                arrowLeftEl.classList.remove('active');
                arrowRightEl.classList.remove('active');

                // Middle row: Period dots (no H/G labels)
                labelLeftEl.textContent = '';
                labelRightEl.textContent = '';
                labelLeftEl.classList.remove('active');
                labelRightEl.classList.remove('active');

                // Show period dots based on current program index
                const periodDots = state.f05CurrentProgramIndex + 1;
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index < periodDots);
                });

                // Bottom row: Score/Wound display (left), Winner (center), Score/Program (right)
                if (state.f05ProgrammingMode) {
                    if (state.f05ProgrammingStep === 'time') {
                        scoreHomeEl.textContent = '';
                        shotClockEl.textContent = '';
                        scoreGuestEl.textContent = `P${String(state.f05DisplayProgram).padStart(2, '0')}`;
                    } else if (state.f05ProgrammingStep === 'wound') {
                        scoreHomeEl.textContent = state.f05WoundTimerPreset;
                        shotClockEl.textContent = '';
                        scoreGuestEl.textContent = state.f05WoundTimerPreset;
                    } else if (state.f05ProgrammingStep === 'bell') {
                        scoreHomeEl.textContent = state.f05FirstBellInterval;
                        shotClockEl.textContent = '';
                        scoreGuestEl.textContent = state.f05FirstBellInterval;
                    }
                } else {
                    // Match mode
                    if (state.f05WoundDisplayLeft) {
                        scoreHomeEl.textContent = state.f05WoundTimerLeft;
                    } else {
                        scoreHomeEl.textContent = state.f05ScoreLeft;
                    }

                    if (state.f05WoundDisplayRight) {
                        scoreGuestEl.textContent = state.f05WoundTimerRight;
                    } else {
                        scoreGuestEl.textContent = state.f05ScoreRight;
                    }

                    // Winner display in center (shot clock position)
                    let winnerStr = '';
                    if (state.f05WinCountLeft !== null) {
                        winnerStr += state.f05WinCountLeft;
                    }
                    if (state.f05WinCountRight !== null) {
                        winnerStr += state.f05WinCountRight;
                    }
                    shotClockEl.textContent = winnerStr;
                }
            } else if (state.functionMode === 'F06') {
                // F06 Mode: Program Timer / Repeat
                // Top row: Timer
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;

                const isTenthsMode = state.showTenths && mins === 0 && secs < 60;
                timerDisplayEl.classList.toggle('left-align', isTenthsMode);

                if (isTenthsMode) {
                    const secsStr = secs < 10 ? `!${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${secsStr}. ${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${mStr}:${sStr}`;
                }

                // Hide arrows for F06
                arrowLeftEl.classList.remove('active');
                arrowRightEl.classList.remove('active');

                // Middle row: Hide H/G labels and dots
                labelLeftEl.textContent = '';
                labelRightEl.textContent = '';
                labelLeftEl.classList.remove('active');
                labelRightEl.classList.remove('active');
                dots.forEach((dot) => {
                    dot.classList.remove('active');
                });

                // Bottom row: Repeat count (left), Program number (right)
                if (state.f06ProgrammingMode) {
                    scoreHomeEl.textContent = state.f06RepeatCount;
                    scoreGuestEl.textContent = `P${String(state.f06DisplayProgram).padStart(2, '0')}`;
                } else if (state.f06MatchRunning) {
                    scoreHomeEl.textContent = state.f06CurrentRepeat;
                    scoreGuestEl.textContent = `P${String(state.f06CurrentProgramIndex + 1).padStart(2, '0')}`;
                } else {
                    scoreHomeEl.textContent = state.f06RepeatCount;
                    scoreGuestEl.textContent = `P${String(state.f06CurrentProgramIndex + 1).padStart(2, '0')}`;
                }
                shotClockEl.textContent = '';
            } else if (state.functionMode === 'F07') {
                // F07 Mode: Shuttle Run
                timerDisplayEl.classList.remove('left-align');

                // Top row: Countdown or shuttle count with arrows
                if (state.f07CountdownPhase) {
                    // Countdown display
                    const mins = Math.floor(state.f07Countdown / 60);
                    const secs = state.f07Countdown % 60;
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${mStr}:${sStr}`;

                    // Only right arrow or left arrow before start
                    arrowLeftEl.classList.toggle('active', state.f07Direction === 'left');
                    arrowRightEl.classList.toggle('active', state.f07Direction === 'right');
                } else {
                    // Shuttle count display
                    timerDisplayEl.textContent = state.f07ShuttleCount;

                    // Current direction arrow
                    arrowLeftEl.classList.toggle('active', !state.f07GoingRight);
                    arrowRightEl.classList.toggle('active', state.f07GoingRight);
                }

                // Middle row: | and dots visualization
                // Using labelLeft/Right and dots for | . . . . . . . | (7 dots)
                const dotCount = state.f07DotCount;
                // For going right: dots from left to right
                // For going left: dots from right to left
                if (state.f07GoingRight || state.f07CountdownPhase) {
                    // Left bar visible if dotCount > 0
                    labelLeftEl.textContent = dotCount > 0 ? '|' : '';
                    labelLeftEl.classList.toggle('active', dotCount > 0);
                    // Dots (1-7)
                    for (let i = 0; i < 7; i++) {
                        dots[i].classList.toggle('active', i < Math.min(dotCount, 7));
                    }
                    // Right bar visible if dotCount >= 8
                    labelRightEl.textContent = dotCount >= 8 ? '|' : '';
                    labelRightEl.classList.toggle('active', dotCount >= 8);
                } else {
                    // Going left - dots from right to left
                    labelRightEl.textContent = dotCount > 0 ? '|' : '';
                    labelRightEl.classList.toggle('active', dotCount > 0);
                    for (let i = 0; i < 7; i++) {
                        dots[6 - i].classList.toggle('active', i < Math.min(dotCount, 7));
                    }
                    labelLeftEl.textContent = dotCount >= 8 ? '|' : '';
                    labelLeftEl.classList.toggle('active', dotCount >= 8);
                }

                // Bottom row: Level | Shuttle time | Score (male-female)
                // Level: L!1 (orange L, orange !, white number)
                let levelStr = String(state.f07Level);
                if (state.f07Level < 10) levelStr = '!' + levelStr;

                const shuttleTimeInt = Math.floor(state.f07ShuttleTime);
                const shuttleTimeFrac = Math.round((state.f07ShuttleTime - shuttleTimeInt) * 10);
                const maleScore = state.f07ScoreMale === 11 ? 'A' : state.f07ScoreMale;
                const femaleScore = state.f07ScoreFemale === 11 ? 'A' : state.f07ScoreFemale;

                scoreHomeEl.innerHTML = `<span style="color:orange">L</span><span style="color:${state.f07Level < 10 ? 'orange' : 'orange'}">${levelStr.replace('!', '!')}</span>`;
                if (state.f07Level < 10) {
                    scoreHomeEl.innerHTML = `<span style="color:orange">L</span><span style="color:orange">!</span><span style="color:orange">${state.f07Level}</span>`;
                } else {
                    scoreHomeEl.innerHTML = `<span style="color:orange">L</span><span style="color:orange">${state.f07Level}</span>`;
                }

                if (state.f07CountdownPhase) {
                    // Hide countdown during pre-countdown phase as requested
                    shotClockEl.innerHTML = '';
                } else {
                    // Show shuttle countdown in red during competition
                    const displayTime = state.f07CurrentTime !== undefined ? state.f07CurrentTime : state.f07ShuttleTime;
                    const cInt = Math.floor(displayTime);
                    const cFrac = Math.floor((displayTime - cInt + 0.0001) * 10);
                    shotClockEl.innerHTML = `<span style="color:#d00">${cInt}.${cFrac}</span>`;
                }

                scoreGuestEl.innerHTML = `<span style="color:#4af">${maleScore}</span><span style="color:orange">-</span><span style="color:#f66">${femaleScore}</span>`;
            } else {
                // F01 Mode: Basketball (original behavior)
                const mins = state.timerMinutes;
                const secs = state.timerSeconds;

                const isTenthsMode = state.showTenths && mins === 0 && secs < 60;
                timerDisplayEl.classList.toggle('left-align', isTenthsMode);

                if (isTenthsMode) {
                    const secsStr = secs < 10 ? `!${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${secsStr}. ${state.timerTenths}`;
                } else {
                    const mStr = mins < 10 ? ` ${mins}` : `${mins}`;
                    const sStr = secs < 10 ? `0${secs}` : `${secs}`;
                    timerDisplayEl.textContent = `${mStr}:${sStr}`;
                }

                arrowLeftEl.classList.toggle('active', state.arrowLeft);
                arrowRightEl.classList.toggle('active', state.arrowRight);

                let leftLabel = 'H';
                let rightLabel = 'G';
                let leftActive = true;
                let rightActive = true;

                if (state.hgState === 2) {
                    leftActive = false;
                    rightActive = false;
                } else if (state.hgState === 1) {
                    leftLabel = 'G';
                    rightLabel = 'H';
                }
                if (state.courtFlipped && state.hgState !== 2) {
                    [leftLabel, rightLabel] = [rightLabel, leftLabel];
                }

                labelLeftEl.textContent = leftLabel;
                labelRightEl.textContent = rightLabel;
                labelLeftEl.classList.toggle('active', leftActive);
                labelRightEl.classList.toggle('active', rightActive);

                const periodMap = { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 'E': 6 };
                const activeDots = periodMap[state.period] || 0;
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index < activeDots);
                });

                if (state.programMode) {
                    scoreHomeEl.textContent = '';
                    scoreGuestEl.textContent = `P${String(state.programNumber).padStart(2, '0')}`;
                } else {
                    const homeScore = state.courtFlipped ? state.scoreGuest : state.scoreHome;
                    const guestScore = state.courtFlipped ? state.scoreHome : state.scoreGuest;
                    const homeBlank = state.courtFlipped ? state.scoreGuestBlank : state.scoreHomeBlank;
                    const guestBlank = state.courtFlipped ? state.scoreHomeBlank : state.scoreGuestBlank;

                    scoreHomeEl.textContent = homeBlank ? '' : homeScore;
                    scoreGuestEl.textContent = guestBlank ? '' : guestScore;
                }

                if (state.shotClockBlank) {
                    shotClockEl.textContent = '';
                } else if (state.shotClock < 10) {
                    shotClockEl.textContent = `${state.shotClock}.${state.shotClockTenths}`;
                } else {
                    shotClockEl.textContent = state.shotClock;
                }
            }
        }

        updateDisplay();
    </script>
</body>

</html>